<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modern OSINT Search Tool</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff;
      color: #222;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
    }
    section {
      background: #f0e6e1;
      border-radius: 12px;
      padding: 24px 24px 18px 24px;
      margin-bottom: 32px;
    }
    h1, h2, h3 {
      color: #B13F17;
      margin-bottom: 12px;
      font-weight: 700;
    }
    h1 {
      font-size: 2.4rem;
      margin-top: 0;
    }
    h2 {
      font-size: 1.5rem;
    }
    h3 {
      font-size: 1.1rem;
    }
    .btn, button, input[type="submit"] {
      background: #B13F17;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 22px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      margin: 0 4px 0 0;
      outline: none;
      box-shadow: none;
    }
    .btn:hover, button:hover, input[type="submit"]:hover {
      background: #8a2e11;
    }
    .btn-small {
      padding: 6px 14px;
      font-size: 0.95rem;
      border-radius: 4px;
    }
    .btn-danger {
      background: #B13F17;
      color: #fff;
    }
    .btn-danger:hover {
      background: #8a2e11;
    }
    input, select, textarea {
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      margin-bottom: 8px;
      background: #fff;
      color: #222;
      outline: none;
      box-shadow: none;
      transition: border 0.2s;
    }
    input:focus, select:focus, textarea:focus {
      border: 1.5px solid #B13F17;
    }
    .search-container {
      display: flex;
      gap: 12px;
      margin-bottom: 18px;
    }
    .search-container input {
      flex: 1;
    }
    .image-upload-area {
      border: 2px dashed #B13F17;
      border-radius: 10px;
      padding: 32px;
      text-align: center;
      background: #fff;
      margin-bottom: 18px;
      cursor: pointer;
      transition: border 0.2s;
    }
    .image-upload-area.drag-over {
      border-color: #8a2e11;
      background: #f0e6e1;
    }
    .upload-icon {
      font-size: 2.2rem;
      color: #B13F17;
      margin-bottom: 8px;
    }
    .upload-text {
      font-size: 1.1rem;
      font-weight: 600;
      color: #B13F17;
      margin-bottom: 4px;
    }
    .upload-hint {
      color: #888;
      font-size: 0.98rem;
    }
    .image-preview {
      background: #fff;
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
    }
    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .preview-img {
      max-width: 260px;
      max-height: 160px;
      border-radius: 8px;
      display: block;
      margin: 0 auto 10px;
    }
    .search-engines-grid {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }
    .search-engine-card {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 16px 18px;
      text-align: center;
      cursor: pointer;
      font-weight: 600;
      color: #B13F17;
      font-size: 1rem;
      transition: background 0.2s, border 0.2s;
    }
    .search-engine-card:hover {
      background: #f0e6e1;
      border: 1.5px solid #B13F17;
    }
    .engine-icon {
      font-size: 1.5rem;
      margin-bottom: 6px;
      display: block;
    }
    .filters-grid {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }
    .filter-section {
      flex: 1 1 220px;
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 0;
    }
    .filter-title {
      font-size: 1.08rem;
      font-weight: 600;
      color: #B13F17;
      margin-bottom: 10px;
    }
    .categories-grid {
      display: flex;
      gap: 18px;
      flex-wrap: wrap;
      margin-bottom: 18px;
    }
    .category-card {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 16px 18px;
      min-width: 220px;
      flex: 1 1 220px;
      margin-bottom: 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .category-checkbox {
      width: 18px;
      height: 18px;
      accent-color: #B13F17;
    }
    .category-title {
      font-size: 1.08rem;
      font-weight: 600;
      color: #B13F17;
      flex-grow: 1;
    }
    .website-count {
      background: #f0e6e1;
      color: #B13F17;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .manage-category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .manage-category-title {
      font-size: 1.08rem;
      font-weight: 600;
      color: #B13F17;
    }
    .manage-category-actions button {
      margin-left: 6px;
    }
    .websites-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #eee;
    }
    .website-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 0;
      background: #f0e6e1;
      border-radius: 6px;
      margin-bottom: 2px;
    }
    .results-container {
      margin-top: 18px;
    }
    .results-filter-box {
      margin-bottom: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .result-category-group {
      margin-bottom: 18px;
      background: #fff;
      border-radius: 8px;
      padding: 10px 14px;
      border: 1px solid #eee;
    }
    .result-category-header {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-weight: 600;
      color: #B13F17;
      font-size: 1.1rem;
      margin-bottom: 8px;
      user-select: none;
    }
    .result-category-header .dropdown-icon {
      margin-left: 8px;
      font-size: 1.1rem;
      transition: transform 0.2s;
    }
    .result-category-header .dropdown-icon.rotated {
      transform: rotate(90deg);
    }
    .result-item {
      background: #f0e6e1;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
      border: 1px solid #eee;
    }
    .highlight {
      background: #ffe0b2;
      color: #B13F17;
      font-weight: bold;
      padding: 0 2px;
      border-radius: 2px;
    }
    .case-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #fff;
      border-radius: 8px;
      padding: 14px 18px;
      margin-bottom: 10px;
    }
    .manage-form {
      display: flex;
      gap: 10px;
      align-items: end;
      margin-bottom: 16px;
    }
    @media (max-width: 900px) {
      .container { padding: 10px; }
      section { padding: 12px 6px; }
      .filters-grid, .categories-grid { flex-direction: column; gap: 10px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header style="text-align:center; margin-bottom:32px;">
      <h1>üïµÔ∏è OSINT Search Tool</h1>
      <p style="color:#888; font-size:1.1rem;">Advanced Open Source Intelligence Investigation Platform</p>
    </header>
    <!-- Search Section -->
    <section>
      <h2>üîç Search Query</h2>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Enter your search keywords...">
        <button id="searchBtn" class="btn">Search</button>
      </div>
    </section>
    <!-- Image Upload Section -->
    <section>
      <h2>üì∑ Reverse Image Search</h2>
      <div class="image-upload-area" id="imageUploadArea">
        <div class="upload-icon">üì∏</div>
        <div class="upload-text">Drop image here or click to upload</div>
        <div class="upload-hint">Supports JPG, PNG, GIF, WebP</div>
        <input type="file" id="imageInput" accept="image/*" style="display: none;">
      </div>
      <div id="imagePreview" class="image-preview" style="display: none;">
        <div class="preview-header">
          <span>Image ready for search</span>
          <button class="btn btn-danger btn-small" id="removeImage">Remove</button>
        </div>
        <img id="previewImg" class="preview-img">
        <div id="imageInfo"></div>
      </div>
      <div id="searchEngines" style="display: none;">
        <div class="search-engines-grid">
          <div class="search-engine-card" data-engine="google">
            <div class="engine-icon">üåç</div>
            <div>Google Images</div>
          </div>
          <div class="search-engine-card" data-engine="bing">
            <div class="engine-icon">üîé</div>
            <div>Bing Visual</div>
          </div>
          <div class="search-engine-card" data-engine="yandex">
            <div class="engine-icon">üåê</div>
            <div>Yandex Images</div>
          </div>
          <div class="search-engine-card" data-engine="tineye">
            <div class="engine-icon">üëÅÔ∏è</div>
            <div>TinEye</div>
          </div>
        </div>
        <button class="btn" id="searchAllEngines">üöÄ Search All Engines</button>
      </div>
    </section>
    <!-- Advanced Filters Section -->
    <section>
      <h2>‚öôÔ∏è Advanced Filters</h2>
      <div class="filters-grid">
        <div class="filter-section">
          <div class="filter-title">üíº LinkedIn Filters</div>
          <input type="text" id="linkedinLocation" placeholder="Location">
          <input type="text" id="linkedinJobTitle" placeholder="Job Title">
          <input type="text" id="linkedinCompany" placeholder="Company">
          <input type="text" id="linkedinSchool" placeholder="School">
        </div>
        <div class="filter-section">
          <div class="filter-title">üìò Facebook Filters</div>
          <input type="text" id="facebookLocation" placeholder="Location">
          <input type="text" id="facebookEducation" placeholder="Education">
          <input type="text" id="facebookWorkplace" placeholder="Workplace">
          <select id="facebookRelationship">
            <option value="">Relationship Status</option>
            <option value="single">Single</option>
            <option value="relationship">In a relationship</option>
            <option value="married">Married</option>
          </select>
        </div>
      </div>
    </section>
    <!-- Categories Section -->
    <section>
      <h2>üìã Search Categories</h2>
      <div class="categories-grid" id="categoriesContainer">
        <!-- Categories will be populated here -->
      </div>
      <div style="margin-bottom: 16px;">
        <button class="btn btn-small" id="selectAllBtn">Select All</button>
        <button class="btn btn-small" id="deselectAllBtn">Deselect All</button>
      </div>
    </section>
    <!-- Management Section -->
    <section class="manage-section">
      <h2>üõ†Ô∏è Manage Categories & Websites</h2>
      <div id="manageCategoriesContainer"></div>
      <div style="margin-top:30px;">
        <input type="text" id="newCategoryInput" placeholder="New category name">
        <button id="addCategoryBtn" class="btn btn-small">Add Category</button>
      </div>
      <div style="margin-top:20px;">
        <select id="categorySelect">
          <option value="">Select Category</option>
        </select>
        <input type="text" id="websiteName" placeholder="Website name">
        <input type="url" id="websiteURL" placeholder="Website URL">
        <button id="addWebsiteBtn" class="btn btn-small">Add Website</button>
      </div>
    </section>
    <!-- Results Section -->
    <section>
      <h2>üìä Search Results</h2>
      <div class="results-filter-box">
        <input type="text" id="resultsFilterInput" placeholder="Filter results by website, category, or keyword..." style="flex:1;">
      </div>
      <div id="resultsContainer" class="results-container">
        <p style="color: #888; text-align: center; padding: 40px;">
          Enter keywords and select categories to start searching
        </p>
      </div>
      <button class="btn" id="exportBtn" style="margin-top: 20px;">üìã Export Report</button>
    </section>
    <!-- Cases Management -->
    <section>
      <h2>üìÅ Saved Cases</h2>
      <input type="text" id="searchCases" placeholder="Search saved cases..." style="margin-bottom: 20px;">
      <div id="casesContainer"></div>
      <button class="btn btn-danger" id="clearCasesBtn" style="margin-top: 20px;">Clear All Cases</button>
    </section>
  </div>
  <script>
    // --- Application State ---
    let categories = {};
    let uploadedImage = null;
    let savedCases = [];

    // --- Persistence Functions ---
    function saveCategoriesToStorage() {
      localStorage.setItem('osint_categories', JSON.stringify(categories));
    }
    function loadCategoriesFromStorage() {
      const stored = localStorage.getItem('osint_categories');
      if (stored) {
        categories = JSON.parse(stored);
      } else {
        categories = {
          "Social Media": [
            { name: "LinkedIn", url: "https://www.linkedin.com/search/results/people/" },
            { name: "Facebook", url: "https://www.facebook.com/search/people/" },
            { name: "Twitter/X", url: "https://twitter.com/search" },
            { name: "Instagram", url: "https://www.instagram.com/explore/tags/" }
          ],
          "Professional Registers": [
            { name: "GMC (UK)", url: "https://www.gmc-uk.org/registration-and-licensing/the-medical-register" },
            { name: "NMC (UK)", url: "https://www.nmc.org.uk/registration/search-the-register/" },
            { name: "SRA (UK)", url: "https://www.sra.org.uk/consumers/register/" }
          ],
          "Company Searches": [
            { name: "Companies House (UK)", url: "https://find-and-update.company-information.service.gov.uk/search/companies" },
            { name: "SEC EDGAR (US)", url: "https://www.sec.gov/edgar/searchedgar/companysearch.html" }
          ],
          "People Search": [
            { name: "Pipl", url: "https://pipl.com/" },
            { name: "WhitePages", url: "https://www.whitepages.com/" },
            { name: "TruePeopleSearch", url: "https://www.truepeoplesearch.com/" }
          ]
        };
      }
    }

    // --- DOM Elements ---
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const imageUploadArea = document.getElementById('imageUploadArea');
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const removeImageBtn = document.getElementById('removeImage');
    const searchEngines = document.getElementById('searchEngines');
    const searchAllEnginesBtn = document.getElementById('searchAllEngines');
    const categoriesContainer = document.getElementById('categoriesContainer');
    const selectAllBtn = document.getElementById('selectAllBtn');
    const deselectAllBtn = document.getElementById('deselectAllBtn');
    const resultsContainer = document.getElementById('resultsContainer');
    const resultsFilterInput = document.getElementById('resultsFilterInput');
    const exportBtn = document.getElementById('exportBtn');
    const casesContainer = document.getElementById('casesContainer');
    const searchCasesInput = document.getElementById('searchCases');
    const clearCasesBtn = document.getElementById('clearCasesBtn');
    const newCategoryInput = document.getElementById('newCategoryInput');
    const addCategoryBtn = document.getElementById('addCategoryBtn');
    const categorySelect = document.getElementById('categorySelect');
    const websiteName = document.getElementById('websiteName');
    const websiteURL = document.getElementById('websiteURL');
    const addWebsiteBtn = document.getElementById('addWebsiteBtn');
    const manageCategoriesContainer = document.getElementById('manageCategoriesContainer');

    // --- Utility Functions ---
    function showNotification(message, type = 'info') {
      document.querySelectorAll('.notification').forEach(n => n.remove());
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.style = `
        position: fixed; top: 24px; right: 24px; background: #B13F17; color: #fff; padding: 14px 22px; border-radius: 8px; font-weight: 600; z-index: 10000; box-shadow: none; font-size: 1rem; opacity: 0; transition: opacity 0.2s;`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.style.opacity = 1, 50);
      setTimeout(() => {
        notification.style.opacity = 0;
        setTimeout(() => notification.remove(), 300);
      }, 2500);
    }
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    function buildSearchURL(site, keyword, filters = {}) {
      let searchURL = site.url;
      const encodedKeyword = encodeURIComponent(keyword);
      if (site.name.toLowerCase().includes('linkedin')) {
        searchURL += `?keywords=${encodedKeyword}`;
        if (filters.linkedinLocation) searchURL += `&geoUrn=${encodeURIComponent(filters.linkedinLocation)}`;
        if (filters.linkedinJobTitle) searchURL += `&title=${encodeURIComponent(filters.linkedinJobTitle)}`;
        if (filters.linkedinCompany) searchURL += `&currentCompany=${encodeURIComponent(filters.linkedinCompany)}`;
        if (filters.linkedinSchool) searchURL += `&school=${encodeURIComponent(filters.linkedinSchool)}`;
      } else if (site.name.toLowerCase().includes('facebook')) {
        let fbSearchURL = 'https://www.facebook.com/search/people/?q=' + encodedKeyword;
        let filters_applied = [];
        if (filters.facebookLocation) filters_applied.push(`location:${encodeURIComponent(filters.facebookLocation)}`);
        if (filters.facebookEducation) filters_applied.push(`education:${encodeURIComponent(filters.facebookEducation)}`);
        if (filters.facebookWorkplace) filters_applied.push(`employer:${encodeURIComponent(filters.facebookWorkplace)}`);
        if (filters.facebookRelationship) filters_applied.push(`relationship:${encodeURIComponent(filters.facebookRelationship)}`);
        if (filters_applied.length > 0) fbSearchURL += '%20' + filters_applied.join('%20');
        searchURL = fbSearchURL;
      } else {
        const separator = searchURL.includes('?') ? '&' : '?';
        searchURL += `${separator}q=${encodedKeyword}`;
      }
      return searchURL;
    }
    function highlightKeyword(text, keyword) {
      if (!keyword) return text;
      const regex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }

    // --- Image Upload Functions ---
    function setupImageUpload() {
      imageUploadArea.addEventListener('click', () => imageInput.click());
      imageInput.addEventListener('change', handleImageSelect);
      ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, preventDefaults, false);
      });
      function preventDefaults(e) { e.preventDefault(); e.stopPropagation(); }
      ['dragenter', 'dragover'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, () => {
          imageUploadArea.classList.add('drag-over');
        }, false);
      });
      ['dragleave', 'drop'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, () => {
          imageUploadArea.classList.remove('drag-over');
        }, false);
      });
      imageUploadArea.addEventListener('drop', handleDrop, false);
      removeImageBtn.addEventListener('click', removeImage);
    }
    function handleImageSelect(e) {
      const file = e.target.files[0];
      if (file) processImage(file);
    }
    function handleDrop(e) {
      const files = e.dataTransfer.files;
      if (files.length > 0) processImage(files[0]);
    }
    function processImage(file) {
      if (!file.type.startsWith('image/')) {
        showNotification('Please select a valid image file', 'error');
        return;
      }
      if (file.size > 10 * 1024 * 1024) {
        showNotification('Image too large. Please select a file under 10MB', 'error');
        return;
      }
      uploadedImage = file;
      const reader = new FileReader();
      reader.onload = (e) => {
        previewImg.src = e.target.result;
        document.getElementById('imageInfo').innerHTML = `<div style="text-align: center; color: #888;"><strong>${file.name}</strong> ‚Ä¢ ${formatFileSize(file.size)}</div>`;
        imagePreview.style.display = 'block';
        searchEngines.style.display = 'block';
        showNotification('Image loaded successfully!', 'success');
      };
      reader.readAsDataURL(file);
    }
    function removeImage() {
      uploadedImage = null;
      imageInput.value = '';
      imagePreview.style.display = 'none';
      searchEngines.style.display = 'none';
      showNotification('Image removed', 'info');
    }

    // --- Search Engine Functions ---
    function setupSearchEngines() {
      document.querySelectorAll('.search-engine-card').forEach(card => {
        card.addEventListener('click', () => {
          const engine = card.dataset.engine;
          openSearchEngine(engine);
        });
      });
      searchAllEnginesBtn.addEventListener('click', () => {
        const engines = ['google', 'bing', 'yandex', 'tineye'];
        engines.forEach((engine, index) => {
          setTimeout(() => openSearchEngine(engine), index * 500);
        });
        showNotification('Opened all search engines!', 'success');
      });
    }
    function openSearchEngine(engine) {
      if (!uploadedImage) {
        showNotification('Please upload an image first', 'error');
        return;
      }
      const urls = {
        google: 'https://images.google.com/',
        bing: 'https://www.bing.com/images/search?view=detailv2&iss=sbi',
        yandex: 'https://yandex.com/images/search?rpt=imageview',
        tineye: 'https://tineye.com/'
      };
      window.open(urls[engine], '_blank');
      showNotification(`Opened ${engine.charAt(0).toUpperCase() + engine.slice(1)}`, 'info');
    }

    // --- Categories Functions ---
    function renderCategories() {
      categoriesContainer.innerHTML = '';
      categorySelect.innerHTML = '<option value="">Select Category</option>';
      Object.keys(categories).forEach(categoryName => {
        // Main categories display (no dropdowns, just tickboxes)
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card';
        categoryCard.innerHTML = `
          <input type="checkbox" class="category-checkbox" data-category="${categoryName}" checked>
          <div class="category-title">${categoryName}</div>
          <span class="website-count">${categories[categoryName].length}</span>
        `;
        // Handle category selection
        const checkbox = categoryCard.querySelector('.category-checkbox');
        checkbox.addEventListener('change', (e) => {
          categoryCard.classList.toggle('selected', e.target.checked);
        });
        categoriesContainer.appendChild(categoryCard);
        // Category select dropdown
        const option = document.createElement('option');
        option.value = categoryName;
        option.textContent = categoryName;
        categorySelect.appendChild(option);
      });
      renderManageCategories();
      saveCategoriesToStorage();
    }
    function renderManageCategories() {
      manageCategoriesContainer.innerHTML = '';
      Object.keys(categories).forEach(categoryName => {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'category-card';
        categoryDiv.style.marginBottom = '12px';
        categoryDiv.innerHTML = `
          <div class="manage-category-header">
            <span class="manage-category-title">${categoryName}</span>
            <span class="manage-category-actions">
              <button class="btn btn-small" onclick="editCategory('${categoryName}')">Edit</button>
              <button class="btn btn-danger btn-small" onclick="deleteCategory('${categoryName}')">Delete</button>
            </span>
          </div>
          <div class="websites-list">
            ${categories[categoryName].map((site, idx) => `
              <div class="website-item">
                <span>${site.name} <span style='color:#888;font-size:0.9em;'>(${site.url})</span></span>
                <span>
                  <button class="btn btn-small" onclick="editWebsite('${categoryName}',${idx})">Edit</button>
                  <button class="btn btn-danger btn-small" onclick="deleteWebsite('${categoryName}',${idx})">Delete</button>
                </span>
              </div>
            `).join('')}
          </div>
        `;
        manageCategoriesContainer.appendChild(categoryDiv);
      });
    }
    window.editCategory = function(categoryName) {
      const newName = prompt('Edit category name:', categoryName);
      if (!newName || newName.trim() === '' || newName === categoryName) return;
      if (categories[newName]) {
        showNotification('Category name already exists', 'error');
        return;
      }
      categories[newName] = categories[categoryName];
      delete categories[categoryName];
      renderCategories();
      showNotification('Category updated successfully', 'success');
    };
    window.deleteCategory = function(categoryName) {
      if (!confirm(`Delete category "${categoryName}" and all its websites?`)) return;
      delete categories[categoryName];
      renderCategories();
      showNotification('Category deleted successfully', 'success');
    };
    window.editWebsite = function(categoryName, idx) {
      const site = categories[categoryName][idx];
      const newName = prompt('Edit website name:', site.name);
      if (!newName) return;
      const newUrl = prompt('Edit website URL:', site.url);
      if (!newUrl) return;
      categories[categoryName][idx] = { name: newName, url: newUrl };
      renderCategories();
    };
    window.deleteWebsite = function(categoryName, idx) {
      if (!confirm('Delete this website?')) return;
      categories[categoryName].splice(idx, 1);
      renderCategories();
    };

    // --- Search Functions ---
    let lastResults = [];
    function performSearch() {
      const keyword = searchInput.value.trim();
      if (!keyword) {
        showNotification('Please enter a search keyword', 'error');
        return;
      }
      const selectedCategories = Array.from(document.querySelectorAll('.category-checkbox:checked')).map(cb => cb.dataset.category);
      if (selectedCategories.length === 0) {
        showNotification('Please select at least one category', 'error');
        return;
      }
      const filters = {
        linkedinLocation: document.getElementById('linkedinLocation').value.trim(),
        linkedinJobTitle: document.getElementById('linkedinJobTitle').value.trim(),
        linkedinCompany: document.getElementById('linkedinCompany').value.trim(),
        linkedinSchool: document.getElementById('linkedinSchool').value.trim(),
        facebookLocation: document.getElementById('facebookLocation').value.trim(),
        facebookEducation: document.getElementById('facebookEducation').value.trim(),
        facebookWorkplace: document.getElementById('facebookWorkplace').value.trim(),
        facebookRelationship: document.getElementById('facebookRelationship').value
      };
      resultsContainer.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 2rem;">üîç</div><div>Searching...</div></div>';
      setTimeout(() => {
        const results = [];
        selectedCategories.forEach(categoryName => {
          categories[categoryName].forEach(site => {
            const searchURL = buildSearchURL(site, keyword, filters);
            const relevanceScore = Math.floor(Math.random() * 10) + 1;
            results.push({
              category: categoryName,
              site: site,
              searchURL: searchURL,
              relevanceScore: relevanceScore,
              keyword: keyword
            });
          });
        });
        results.sort((a, b) => b.relevanceScore - a.relevanceScore);
        lastResults = results;
        renderResultsGrouped(results, keyword, resultsFilterInput.value);
        saveCase(keyword, selectedCategories, filters, results);
        showNotification(`Search completed! Found ${results.length} sources`, 'success');
      }, 1200);
    }

    function renderResultsGrouped(results, keyword, filterText = '') {
      // Group by category
      const grouped = {};
      results.forEach(r => {
        if (filterText && !(
          r.site.name.toLowerCase().includes(filterText.toLowerCase()) ||
          r.category.toLowerCase().includes(filterText.toLowerCase()) ||
          r.keyword.toLowerCase().includes(filterText.toLowerCase())
        )) return;
        if (!grouped[r.category]) grouped[r.category] = [];
        grouped[r.category].push(r);
      });
      resultsContainer.innerHTML = '';
      if (Object.keys(grouped).length === 0) {
        resultsContainer.innerHTML = '<p style="color: #888; text-align: center; padding: 40px;">No results found for this filter.</p>';
        return;
      }
      Object.keys(grouped).forEach(category => {
        const groupDiv = document.createElement('div');
        groupDiv.className = 'result-category-group';
        // Collapsible header
        const header = document.createElement('div');
        header.className = 'result-category-header';
        header.innerHTML = `<span>${category}</span><span class="dropdown-icon">‚ñ∂</span>`;
        groupDiv.appendChild(header);
        // Results list
        const list = document.createElement('div');
        grouped[category].forEach(result => {
          const resultDiv = document.createElement('div');
          resultDiv.className = 'result-item';
          // Highlight keyword in site name and preview
          const preview = `Search for: "${result.keyword}"`;
          resultDiv.innerHTML = `
            <div style="margin-bottom: 8px;">
              <strong>${highlightKeyword(result.site.name, keyword)}</strong>
            </div>
            <div style="margin-bottom: 8px;">${highlightKeyword(preview, keyword)}</div>
            <div style="margin-bottom: 8px;">
              <em>Relevance score: ${result.relevanceScore}/10</em>
            </div>
            <a href="${result.searchURL}" target="_blank" class="btn btn-small">üîó Open Search</a>
          `;
          list.appendChild(resultDiv);
        });
        groupDiv.appendChild(list);
        // Collapsible logic
        let open = true;
        header.addEventListener('click', () => {
          open = !open;
          list.style.display = open ? '' : 'none';
          header.querySelector('.dropdown-icon').classList.toggle('rotated', open);
        });
        resultsContainer.appendChild(groupDiv);
      });
    }

    // --- Results Filter ---
    resultsFilterInput.addEventListener('input', () => {
      renderResultsGrouped(lastResults, searchInput.value.trim(), resultsFilterInput.value);
    });

    // --- Cases Management ---
    function saveCase(keyword, categoriesArr, filters, results) {
      const caseData = {
        id: Date.now(),
        keyword: keyword,
        categories: categoriesArr,
        filters: filters,
        results: results,
        timestamp: new Date().toISOString(),
        date: new Date().toLocaleDateString()
      };
      savedCases.unshift(caseData);
      if (savedCases.length > 50) savedCases = savedCases.slice(0, 50);
      renderCases();
    }
    function renderCases(filterText = '') {
      const filteredCases = savedCases.filter(c =>
        c.keyword.toLowerCase().includes(filterText.toLowerCase()) ||
        c.date.includes(filterText)
      );
      casesContainer.innerHTML = '';
      if (filteredCases.length === 0) {
        casesContainer.innerHTML = '<p style="text-align: center; color: #888; padding: 40px;">No saved cases found</p>';
        return;
      }
      filteredCases.forEach(caseData => {
        const caseDiv = document.createElement('div');
        caseDiv.className = 'case-item';
        caseDiv.innerHTML = `
          <div>
            <div style="font-weight: 600; color: #B13F17; margin-bottom: 5px;">"${caseData.keyword}"</div>
            <div style="color: #888; font-size: 0.9rem;">${caseData.date} ‚Ä¢ ${caseData.categories.length} categories ‚Ä¢ ${caseData.results.length} results</div>
          </div>
          <div>
            <button class="btn btn-small" onclick="loadCase(${caseData.id})">Load</button>
            <button class="btn btn-danger btn-small" onclick="deleteCase(${caseData.id})">Delete</button>
          </div>
        `;
        casesContainer.appendChild(caseDiv);
      });
    }
    window.loadCase = function(caseId) {
      const caseData = savedCases.find(c => c.id === caseId);
      if (!caseData) return;
      searchInput.value = caseData.keyword;
      // Restore filters
      Object.entries(caseData.filters).forEach(([key, value]) => {
        const element = document.getElementById(key);
        if (element) element.value = value || '';
      });
      // Restore category selections
      document.querySelectorAll('.category-checkbox').forEach(cb => {
        cb.checked = caseData.categories.includes(cb.dataset.category);
        cb.closest('.category-card').classList.toggle('selected', cb.checked);
      });
      // Restore results
      lastResults = caseData.results;
      renderResultsGrouped(caseData.results, caseData.keyword, resultsFilterInput.value);
      showNotification('Case loaded successfully', 'success');
    };
    window.deleteCase = function(caseId) {
      if (!confirm('Delete this case?')) return;
      savedCases = savedCases.filter(c => c.id !== caseId);
      renderCases(searchCasesInput.value);
      showNotification('Case deleted', 'success');
    };

    // --- Export Functions ---
    function exportReport() {
      if (!resultsContainer.innerHTML.trim() || resultsContainer.innerHTML.includes('Enter keywords')) {
        showNotification('No results to export', 'error');
        return;
      }
      const timestamp = new Date().toLocaleString();
      const keyword = searchInput.value.trim();
      const htmlContent = `
        <!DOCTYPE html>
        <html>
        <head>
          <title>OSINT Report - ${keyword}</title>
          <meta charset="UTF-8">
          <style>
            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 30px; max-width: 800px; margin: 0 auto; }
            h1 { color: #B13F17; border-bottom: 3px solid #B13F17; padding-bottom: 10px; }
            .result-item { margin-bottom: 25px; padding: 15px; border: 1px solid #e9ecef; border-radius: 8px; }
            a { color: #B13F17; text-decoration: none; }
            .header-info { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
          </style>
        </head>
        <body>
          <div class="header-info">
            <h1>üîç OSINT Search Report</h1>
            <h2>Search Query: "${keyword}"</h2>
            <p>Generated: ${timestamp}</p>
          </div>
          ${resultsContainer.innerHTML}
          <div style="margin-top: 40px; color: #666; font-size: 0.9em;">
            <p>Report generated by Modern OSINT Search Tool</p>
            <p>‚ö†Ô∏è Verify all information through multiple sources</p>
          </div>
        </body>
        </html>
      `;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `OSINT_Report_${keyword.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showNotification('Report exported successfully', 'success');
    }

    // --- Event Listeners ---
    function setupEventListeners() {
      searchBtn.addEventListener('click', performSearch);
      searchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') performSearch(); });
      selectAllBtn.addEventListener('click', () => {
        document.querySelectorAll('.category-checkbox').forEach(cb => {
          cb.checked = true;
          cb.closest('.category-card').classList.add('selected');
        });
        showNotification('All categories selected', 'success');
      });
      deselectAllBtn.addEventListener('click', () => {
        document.querySelectorAll('.category-checkbox').forEach(cb => {
          cb.checked = false;
          cb.closest('.category-card').classList.remove('selected');
        });
        showNotification('All categories deselected', 'info');
      });
      addCategoryBtn.addEventListener('click', () => {
        const name = newCategoryInput.value.trim();
        if (!name) {
          showNotification('Please enter a category name', 'error');
          return;
        }
        if (categories[name]) {
          showNotification('Category already exists', 'error');
          return;
        }
        categories[name] = [];
        newCategoryInput.value = '';
        renderCategories();
        showNotification('Category added successfully', 'success');
      });
      addWebsiteBtn.addEventListener('click', () => {
        const category = categorySelect.value;
        const name = websiteName.value.trim();
        const url = websiteURL.value.trim();
        if (!category || !name || !url) {
          showNotification('Please fill all fields', 'error');
          return;
        }
        try {
          new URL(url);
          categories[category].push({ name, url });
          websiteName.value = '';
          websiteURL.value = '';
          renderCategories();
          showNotification('Website added successfully', 'success');
        } catch {
          showNotification('Please enter a valid URL', 'error');
        }
      });
      exportBtn.addEventListener('click', exportReport);
      searchCasesInput.addEventListener('input', (e) => {
        renderCases(e.target.value);
      });
      clearCasesBtn.addEventListener('click', () => {
        if (!confirm('Clear all saved cases?')) return;
        savedCases = [];
        renderCases();
        showNotification('All cases cleared', 'success');
      });
    }

    // --- Initialize Application ---
    function init() {
      loadCategoriesFromStorage();
      setupImageUpload();
      setupSearchEngines();
      setupEventListeners();
      renderCategories();
      renderCases();
      showNotification('Modern OSINT Tool loaded successfully!', 'success');
    }
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>