<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OSINT Search Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    input[type="text"], select {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      margin: 5px 5px 5px 0;
      padding: 6px 10px;
      cursor: pointer;
    }
    .category {
      margin-bottom: 10px;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
    }
    .results {
      margin-top: 20px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
    details summary {
      cursor: pointer;
      padding: 5px 0;
      font-weight: bold;
    }
    .checkboxes {
      margin-bottom: 15px;
    }
    #advancedFilters {
      display: none;
      margin-top: 10px;
      background: #eef;
      padding: 10px;
      border-radius: 6px;
    }
    .image-search-buttons button {
      margin-right: 8px;
      margin-top: 4px;
    }
    .search-result {
      border-bottom: 1px solid #ddd;
      padding: 5px 0;
    }
    .relevance-score {
      font-weight: bold;
      color: green;
      margin-left: 10px;
    }
  </style>
</head>
<body>

  <h1>OSINT Search Tool</h1>

  <label for="keyword">Keyword Search</label>
  <input type="text" id="keyword" placeholder="Enter keyword..." />

  <div class="checkboxes" id="categoryCheckboxes"></div>

  <!-- Advanced filters shown only if 'Social Media' category checked -->
  <div id="advancedFilters">
    <h3>Social Media Advanced Filters</h3>
    <input type="text" id="filterWorkplace" placeholder="Workplace" />
    <input type="text" id="filterLocation" placeholder="Location" />
    <input type="text" id="filterEducation" placeholder="Education" />
  </div>

  <button onclick="performSearch()">Search</button>

  <h2>Reverse Image Search</h2>
  <input type="file" id="imageUpload" accept="image/*" />
  <div class="image-search-buttons">
    <button onclick="reverseImageSearch('google')">Search Google Images</button>
    <button onclick="reverseImageSearch('tineye')">Search TinEye</button>
    <button onclick="reverseImageSearch('bing')">Search Bing</button>
  </div>

  <h2>Add New Website</h2>
  <input type="text" id="newWebsite" placeholder="Enter website URL" />
  <select id="categorySelect"></select>
  <button onclick="addSite()">Add Website</button>

  <h2>Add New Category</h2>
  <input type="text" id="newCategory" placeholder="Enter category name" />
  <button onclick="addCategory()">Add Category</button>

  <h2>Categories & Sites</h2>
  <div id="categoryContainer"></div>

  <div class="results" id="searchResults"></div>

<script>
  // Initial categories and sites
  let categories = JSON.parse(localStorage.getItem('categories')) || {
    "Company Searches": ["https://find-and-update.company-information.service.gov.uk/"],
    "Court Case Searches": ["https://www.casemine.com/"],
    "Occupation Registers": ["https://www.gdc-uk.org/pages/searchregisters.aspx"],
    "Genealogy": ["https://probatesearch.service.gov.uk/#wills"],
    "Transport": ["https://cartaxcheck.co.uk/"],
    "Sanctions, Watchlists, PEPs": ["https://www.insolvencydirect.bis.gov.uk/eiir/search"],
    "Social Media": ["https://www.facebook.com/"],
    "Offshore Companies": ["https://offshoreleaks.icij.org/"],
    "Domain/Leaked/Cached": ["https://who.is/"]
  };

  // Save categories to localStorage
  function saveToLocal() {
    localStorage.setItem('categories', JSON.stringify(categories));
  }

  // Render categories list, dropdown for add-site, and checkbox list for search
  function renderCategories() {
    const container = document.getElementById('categoryContainer');
    const select = document.getElementById('categorySelect');
    const checkboxArea = document.getElementById('categoryCheckboxes');

    container.innerHTML = '';
    select.innerHTML = '';
    checkboxArea.innerHTML = '';

    Object.entries(categories).forEach(([cat, urls], index) => {
      // Dropdown with expandable site list and delete buttons
      const catDiv = document.createElement('div');
      catDiv.className = 'category';
      catDiv.innerHTML = `
        <details>
          <summary>${cat} <button onclick="deleteCategory('${cat}')" style="float:right;">Delete Category</button></summary>
          <ul>
            ${urls.map(url => `<li>${url} <button onclick="deleteSite('${cat}', '${url}')" style="color:red;">x</button></li>`).join('')}
          </ul>
        </details>
      `;
      container.appendChild(catDiv);

      // Add to select dropdown for adding sites
      const option = document.createElement('option');
      option.value = cat;
      option.text = cat;
      select.appendChild(option);

      // Add to checkbox list for search
      const checkbox = document.createElement('div');
      checkbox.innerHTML = `
        <input type="checkbox" id="cat_${index}" value="${cat}" onchange="toggleAdvancedFilters()" />
        <label for="cat_${index}">${cat}</label>
      `;
      checkboxArea.appendChild(checkbox);
    });
  }

  // Add a new category
  function addCategory() {
    const newCat = document.getElementById('newCategory').value.trim();
    if (!newCat) {
      alert('Please enter a category name.');
      return;
    }
    if (categories[newCat]) {
      alert('Category already exists.');
      return;
    }
    categories[newCat] = [];
    saveToLocal();
    renderCategories();
    document.getElementById('newCategory').value = '';
  }

  // Delete a category
  function deleteCategory(cat) {
    if (confirm(`Are you sure you want to delete category "${cat}" and all its websites?`)) {
      delete categories[cat];
      saveToLocal();
      renderCategories();
    }
  }

  // Add a new website to a category
  function addSite() {
    const url = document.getElementById('newWebsite').value.trim();
    const cat = document.getElementById('categorySelect').value;
    if (!url) {
      alert('Please enter a website URL.');
      return;
    }
    if (!cat) {
      alert('Please select a category.');
      return;
    }
    if (categories[cat].includes(url)) {
      alert('This website already exists in the selected category.');
      return;
    }
    categories[cat].push(url);
    saveToLocal();
    renderCategories();
    document.getElementById('newWebsite').value = '';
  }

  // Delete a website from a category
  function deleteSite(cat, url) {
    if (confirm(`Delete website ${url} from category "${cat}"?`)) {
      categories[cat] = categories[cat].filter(u => u !== url);
      saveToLocal();
      renderCategories();
    }
  }

  // Show/hide advanced filters if Social Media category is checked
  function toggleAdvancedFilters() {
    const checkboxes = document.querySelectorAll('#categoryCheckboxes input[type="checkbox"]');
    const socialChecked = Array.from(checkboxes).some(cb => cb.value === 'Social Media' && cb.checked);
    document.getElementById('advancedFilters').style.display = socialChecked ? 'block' : 'none';
  }

  // Dummy relevance score function
  function relevanceScore(url, keyword) {
    const count = (url.toLowerCase().match(new RegExp(keyword.toLowerCase(), 'g')) || []).length;
    return Math.min(100, count * 20); // max 100%
  }

  // Perform search (simple keyword filter and show results)
  function performSearch() {
    const keyword = document.getElementById('keyword').value.trim();
    const selectedCats = Array.from(document.querySelectorAll('#categoryCheckboxes input[type="checkbox"]:checked'))
                              .map(cb => cb.value);
    const resultsDiv = document.getElementById('searchResults');
    resultsDiv.innerHTML = '';

    if (!keyword) {
      alert('Please enter a keyword to search.');
      return;
    }
    if (selectedCats.length === 0) {
      alert('Please select at least one category.');
      return;
    }

    let results = [];

    selectedCats.forEach(cat => {
      const sites = categories[cat];
      sites.forEach(site => {
        if (site.toLowerCase().includes(keyword.toLowerCase())) {
          results.push({ category: cat, url: site, score: relevanceScore(site, keyword) });
        }
      });
    });

    if (results.length === 0) {
      resultsDiv.innerHTML = '<p>No results found.</p>';
      return;
    }

    // Sort results by relevance score descending
    results.sort((a,b) => b.score - a.score);

   
    // Display results
    results.forEach(res => {
      const div = document.createElement('div');
      div.className = 'search-result';
      div.innerHTML = `
        <strong>${res.category}</strong>: <a href="${res.url}" target="_blank" rel="noopener">${res.url}</a>
        <span class="relevance-score">${res.score}% relevance</span>
      `;
      resultsDiv.appendChild(div);
    });
  }

  // Reverse image search helper
  function reverseImageSearch(engine) {
    const input = document.getElementById('imageUpload');
    if (input.files.length === 0) {
      alert('Please upload an image first.');
      return;
    }
    const file = input.files[0];
    const url = URL.createObjectURL(file);

    let searchUrl = '';
    if (engine === 'google') {
      searchUrl = `https://www.google.com/searchbyimage?&image_url=${encodeURIComponent(url)}`;
    } else if (engine === 'tineye') {
      searchUrl = `https://tineye.com/search?url=${encodeURIComponent(url)}`;
    } else if (engine === 'bing') {
      searchUrl = `https://www.bing.com/images/search?q=imgurl:${encodeURIComponent(url)}&view=detailv2&iss=sbi`;
    }

    window.open(searchUrl, '_blank');
    URL.revokeObjectURL(url);
  }

  // Initial render
  renderCategories();

  // Show/hide advanced filters on page load if needed
  toggleAdvancedFilters();

</script>
</body>
</html>
