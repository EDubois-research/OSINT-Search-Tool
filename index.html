<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern OSINT Search Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --brand-primary: #B13F17;
            --brand-hover: #8a2e11;
            --brand-light: #f0e6e1;
            --bg-primary: #ffffff;
            --bg-secondary: #ffffff;
            --bg-tertiary: #252525;
            --text-primary: #252525;
            --text-secondary: #b0b0b0;
            --accent: #082248;
            --success: #082248;
            --error: #082248;
            --warning: #082248;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(177, 63, 23, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 136, 0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(1deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--brand-primary), var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(177, 63, 23, 0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .glass-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .glass-panel:hover::before {
            left: 100%;
        }

        .glass-panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(177, 63, 23, 0.3);
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--brand-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 30px;
            background: linear-gradient(45deg, var(--brand-primary), var(--accent));
            border-radius: 2px;
        }

        .search-container {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            margin-bottom: 30px;
        }

        .search-input {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px 20px;
            font-size: 1.1rem;
            color: var(--text-primary);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 20px rgba(177, 63, 23, 0.3);
            transform: scale(1.02);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .btn {
            background: linear-gradient(45deg, var(--brand-primary), var(--brand-hover));
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 30px rgba(177, 63, 23, 0.4);
        }

        .btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        .btn-secondary {
            background: linear-gradient(45deg, var(--accent), #0099cc);
        }

        .btn-success {
            background: linear-gradient(45deg, var(--success), #00cc66);
        }

        .btn-danger {
            background: linear-gradient(45deg, var(--error), #cc3644);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 10px;
        }

        .image-upload-area {
            border: 3px dashed rgba(177, 63, 23, 0.5);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(177, 63, 23, 0.05);
            margin-bottom: 20px;
            position: relative;
        }

        .image-upload-area:hover {
            border-color: var(--brand-primary);
            background: rgba(177, 63, 23, 0.1);
            transform: scale(1.02);
        }

        .image-upload-area.drag-over {
            border-color: var(--success);
            background: rgba(0, 255, 136, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--brand-primary);
        }

        .upload-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--brand-primary);
            margin-bottom: 10px;
        }

        .upload-hint {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .image-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .preview-img {
            max-width: 300px;
            max-height: 200px;
            border-radius: 10px;
            display: block;
            margin: 0 auto 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .search-engines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .search-engine-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .search-engine-card:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            border-color: var(--brand-primary);
        }

        .engine-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .category-card.selected {
            border-color: var(--brand-primary);
            background: rgba(177, 63, 23, 0.2);
        }

        .category-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            cursor: pointer;
        }

        .category-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: var(--brand-primary);
        }

        .category-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--brand-primary);
            flex-grow: 1;
        }

        .website-count {
            background: rgba(177, 63, 23, 0.2);
            color: var(--brand-primary);
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .websites-list {
            display: none;
            gap: 10px;
            flex-direction: column;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .websites-list.visible {
            display: flex;
        }

        .website-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .website-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .filter-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .filter-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 10px 15px;
            color: var(--text-primary);
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--brand-primary);
            box-shadow: 0 0 10px rgba(177, 63, 23, 0.3);
        }

        .results-container {
            margin-top: 30px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateX(10px);
            border-color: var(--brand-primary);
        }

        .case-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .case-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }

        .manage-form {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: end;
            margin-bottom: 20px;
        }

        .floating-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--brand-primary), var(--brand-hover));
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(177, 63, 23, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .floating-fab:hover {
            transform: scale(1.1) rotate(180deg);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(400px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(45deg, var(--success), #00cc66);
        }

        .notification.error {
            background: linear-gradient(45deg, var(--error), #cc3644);
        }

        .notification.info {
            background: linear-gradient(45deg, var(--accent), #0099cc);
        }

        .dropdown-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .dropdown-icon {
            transition: transform 0.3s ease;
            font-size: 1.2rem;
        }

        .dropdown-icon.rotated {
            transform: rotate(180deg);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .search-container {
                grid-template-columns: 1fr;
            }
            
            .categories-grid {
                grid-template-columns: 1fr;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            .glass-panel {
                padding: 20px;
                border-radius: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="background-animation"></div>
    
    <div class="container">
        <header class="header">
            <h1>🕵️ OSINT Search Tool</h1>
            <p>Advanced Open Source Intelligence Investigation Platform</p>
        </header>

        <!-- Search Section -->
        <section class="glass-panel">
            <h2 class="section-title">🔍 Search Query</h2>
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Enter your search keywords...">
                <button id="searchBtn" class="btn">Search</button>
            </div>
        </section>

        <!-- Image Upload Section -->
        <section class="glass-panel">
            <h2 class="section-title">📷 Reverse Image Search</h2>
            <div class="image-upload-area" id="imageUploadArea">
                <div class="upload-icon">📸</div>
                <div class="upload-text">Drop image here or click to upload</div>
                <div class="upload-hint">Supports JPG, PNG, GIF, WebP</div>
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
            </div>
            
            <div id="imagePreview" class="image-preview" style="display: none;">
                <div class="preview-header">
                    <span>Image ready for search</span>
                    <button class="btn btn-danger btn-small" id="removeImage">Remove</button>
                </div>
                <img id="previewImg" class="preview-img">
                <div id="imageInfo"></div>
            </div>

            <div id="searchEngines" style="display: none;">
                <div class="search-engines-grid">
                    <div class="search-engine-card" data-engine="google">
                        <div class="engine-icon">🌍</div>
                        <div>Google Images</div>
                    </div>
                    <div class="search-engine-card" data-engine="bing">
                        <div class="engine-icon">🔎</div>
                        <div>Bing Visual</div>
                    </div>
                    <div class="search-engine-card" data-engine="yandex">
                        <div class="engine-icon">🌐</div>
                        <div>Yandex Images</div>
                    </div>
                    <div class="search-engine-card" data-engine="tineye">
                        <div class="engine-icon">👁️</div>
                        <div>TinEye</div>
                    </div>
                </div>
                <button class="btn btn-success" id="searchAllEngines">🚀 Search All Engines</button>
            </div>
        </section>

        <!-- Advanced Filters Section -->
        <section class="glass-panel">
            <h2 class="section-title">⚙️ Advanced Filters</h2>
            <div class="filters-grid">
                <div class="filter-section">
                    <div class="filter-title">💼 LinkedIn Filters</div>
                    <input type="text" id="linkedinLocation" class="filter-input" placeholder="Location">
                    <input type="text" id="linkedinJobTitle" class="filter-input" placeholder="Job Title">
                    <input type="text" id="linkedinCompany" class="filter-input" placeholder="Company">
                    <input type="text" id="linkedinSchool" class="filter-input" placeholder="School">
                </div>
                <div class="filter-section">
                    <div class="filter-title">📘 Facebook Filters</div>
                    <input type="text" id="facebookLocation" class="filter-input" placeholder="Location">
                    <input type="text" id="facebookEducation" class="filter-input" placeholder="Education">
                    <input type="text" id="facebookWorkplace" class="filter-input" placeholder="Workplace">
                    <select id="facebookRelationship" class="filter-input">
                        <option value="">Relationship Status</option>
                        <option value="single">Single</option>
                        <option value="relationship">In a relationship</option>
                        <option value="married">Married</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="glass-panel">
            <h2 class="section-title">📋 Search Categories</h2>
            <div style="margin-bottom: 20px;">
                <button class="btn btn-secondary btn-small" id="selectAllBtn">Select All</button>
                <button class="btn btn-small" id="deselectAllBtn">Deselect All</button>
            </div>
            <div class="categories-grid" id="categoriesContainer">
                <!-- Categories will be populated here -->
            </div>
        </section>

        <!-- Management Section -->
        <section class="glass-panel">
            <h2 class="section-title">🛠️ Manage Categories & Websites</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="color: var(--brand-primary); margin-bottom: 15px;">Add Category</h3>
                <div class="manage-form">
                    <input type="text" id="newCategoryInput" class="search-input" placeholder="Category name">
                    <button class="btn" id="addCategoryBtn">Add Category</button>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: var(--brand-primary); margin-bottom: 15px;">Add Website</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                    <select id="categorySelect" class="search-input">
                        <option value="">Select Category</option>
                    </select>
                    <input type="text" id="websiteName" class="search-input" placeholder="Website name">
                    <input type="url" id="websiteURL" class="search-input" placeholder="Website URL">
                    <button class="btn" id="addWebsiteBtn">Add Website</button>
                </div>
            </div>

            <div id="manageCategoriesContainer">
                <!-- Management interface will be populated here -->
            </div>
        </section>

        <!-- Results Section -->
        <section class="glass-panel">
            <h2 class="section-title">📊 Search Results</h2>
            <div id="resultsContainer">
                <p style="color: var(--text-secondary); text-align: center; padding: 40px;">
                    Enter keywords and select categories to start searching
                </p>
            </div>
            <button class="btn btn-success" id="exportBtn" style="margin-top: 20px;">📋 Export Report</button>
        </section>

        <!-- Cases Management -->
        <section class="glass-panel">
            <h2 class="section-title">📁 Saved Cases</h2>
            <input type="text" id="searchCases" class="search-input" placeholder="Search saved cases..." style="margin-bottom: 20px;">
            <div id="casesContainer">
                <!-- Cases will be populated here -->
            </div>
            <button class="btn btn-danger" id="clearCasesBtn" style="margin-top: 20px;">Clear All Cases</button>
        </section>
    </div>

    <button class="floating-fab" id="scrollToTop" title="Scroll to top">↑</button>

    <script>
        // Application State
        let categories = {
            "Social Media": [
                { name: "LinkedIn", url: "https://www.linkedin.com/search/results/people/" },
                { name: "Facebook", url: "https://www.facebook.com/search/people/" },
                { name: "Twitter/X", url: "https://twitter.com/search" },
                { name: "Instagram", url: "https://www.instagram.com/explore/tags/" }
            ],
            "Professional Registers": [
                { name: "GMC (UK)", url: "https://www.gmc-uk.org/registration-and-licensing/the-medical-register" },
                { name: "NMC (UK)", url: "https://www.nmc.org.uk/registration/search-the-register/" },
                { name: "SRA (UK)", url: "https://www.sra.org.uk/consumers/register/" }
            ],
            "Company Searches": [
                { name: "Companies House (UK)", url: "https://find-and-update.company-information.service.gov.uk/search/companies" },
                { name: "SEC EDGAR (US)", url: "https://www.sec.gov/edgar/searchedgar/companysearch.html" }
            ],
            "People Search": [
                { name: "Pipl", url: "https://pipl.com/" },
                { name: "WhitePages", url: "https://www.whitepages.com/" },
                { name: "TruePeopleSearch", url: "https://www.truepeoplesearch.com/" }
            ]
        };

        let uploadedImage = null;
        let savedCases = [];

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const imageUploadArea = document.getElementById('imageUploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const removeImageBtn = document.getElementById('removeImage');
        const searchEngines = document.getElementById('searchEngines');
        const searchAllEnginesBtn = document.getElementById('searchAllEngines');
        const categoriesContainer = document.getElementById('categoriesContainer');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const deselectAllBtn = document.getElementById('deselectAllBtn');
        const resultsContainer = document.getElementById('resultsContainer');
        const exportBtn = document.getElementById('exportBtn');
        const casesContainer = document.getElementById('casesContainer');
        const searchCasesInput = document.getElementById('searchCases');
        const clearCasesBtn = document.getElementById('clearCasesBtn');
        const newCategoryInput = document.getElementById('newCategoryInput');
        const addCategoryBtn = document.getElementById('addCategoryBtn');
        const categorySelect = document.getElementById('categorySelect');
        const websiteName = document.getElementById('websiteName');
        const websiteURL = document.getElementById('websiteURL');
        const addWebsiteBtn = document.getElementById('addWebsiteBtn');
        const manageCategoriesContainer = document.getElementById('manageCategoriesContainer');
        const scrollToTopBtn = document.getElementById('scrollToTop');

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function buildSearchURL(site, keyword, filters = {}) {
            let searchURL = site.url;
            const encodedKeyword = encodeURIComponent(keyword);
            
            if (site.name.toLowerCase().includes('linkedin')) {
                searchURL += `?keywords=${encodedKeyword}`;
                if (filters.linkedinLocation) searchURL += `&geoUrn=${encodeURIComponent(filters.linkedinLocation)}`;
                if (filters.linkedinJobTitle) searchURL += `&title=${encodeURIComponent(filters.linkedinJobTitle)}`;
                if (filters.linkedinCompany) searchURL += `&currentCompany=${encodeURIComponent(filters.linkedinCompany)}`;
                if (filters.linkedinSchool) searchURL += `&school=${encodeURIComponent(filters.linkedinSchool)}`;
            } else if (site.name.toLowerCase().includes('facebook')) {
                let fbSearchURL = 'https://www.facebook.com/search/people/?q=' + encodedKeyword;
                let filters_applied = [];
                
                if (filters.facebookLocation) filters_applied.push(`location:${encodeURIComponent(filters.facebookLocation)}`);
                if (filters.facebookEducation) filters_applied.push(`education:${encodeURIComponent(filters.facebookEducation)}`);
                if (filters.facebookWorkplace) filters_applied.push(`employer:${encodeURIComponent(filters.facebookWorkplace)}`);
                if (filters.facebookRelationship) filters_applied.push(`relationship:${encodeURIComponent(filters.facebookRelationship)}`);
                
                if (filters_applied.length > 0) {
                    fbSearchURL += '%20' + filters_applied.join('%20');
                }
                searchURL = fbSearchURL;
            } else {
                const separator = searchURL.includes('?') ? '&' : '?';
                searchURL += `${separator}q=${encodedKeyword}`;
            }
            
            return searchURL;
        }

        // Image Upload Functions
        function setupImageUpload() {
            imageUploadArea.addEventListener('click', () => imageInput.click());
            
            imageInput.addEventListener('change', handleImageSelect);
            
            // Drag and drop
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                imageUploadArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                imageUploadArea.addEventListener(eventName, () => {
                    imageUploadArea.classList.add('drag-over');
                }, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                imageUploadArea.addEventListener(eventName, () => {
                    imageUploadArea.classList.remove('drag-over');
                }, false);
            });

            imageUploadArea.addEventListener('drop', handleDrop, false);
            
            removeImageBtn.addEventListener('click', removeImage);
        }

        function handleImageSelect(e) {
            const file = e.target.files[0];
            if (file) processImage(file);
        }

        function handleDrop(e) {
            const files = e.dataTransfer.files;
            if (files.length > 0) processImage(files[0]);
        }

        function processImage(file) {
            if (!file.type.startsWith('image/')) {
                showNotification('Please select a valid image file', 'error');
                return;
            }

            if (file.size > 10 * 1024 * 1024) {
                showNotification('Image too large. Please select a file under 10MB', 'error');
                return;
            }

            uploadedImage = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                document.getElementById('imageInfo').innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary);">
                        <strong>${file.name}</strong> • ${formatFileSize(file.size)}
                    </div>
                `;
                imagePreview.style.display = 'block';
                searchEngines.style.display = 'block';
                showNotification('Image loaded successfully!', 'success');
            };
            reader.readAsDataURL(file);
        }

        function removeImage() {
            uploadedImage = null;
            imageInput.value = '';
            imagePreview.style.display = 'none';
            searchEngines.style.display = 'none';
            showNotification('Image removed', 'info');
        }

        // Search Engine Functions
        function setupSearchEngines() {
            document.querySelectorAll('.search-engine-card').forEach(card => {
                card.addEventListener('click', () => {
                    const engine = card.dataset.engine;
                    openSearchEngine(engine);
                });
            });

            searchAllEnginesBtn.addEventListener('click', () => {
                const engines = ['google', 'bing', 'yandex', 'tineye'];
                engines.forEach((engine, index) => {
                    setTimeout(() => openSearchEngine(engine), index * 500);
                });
                showNotification('Opened all search engines!', 'success');
            });
        }

        function openSearchEngine(engine) {
            if (!uploadedImage) {
                showNotification('Please upload an image first', 'error');
                return;
            }

            const urls = {
                google: 'https://images.google.com/',
                bing: 'https://www.bing.com/images/search?view=detailv2&iss=sbi',
                yandex: 'https://yandex.com/images/search?rpt=imageview',
                tineye: 'https://tineye.com/'
            };

            window.open(urls[engine], '_blank');
            showNotification(`Opened ${engine.charAt(0).toUpperCase() + engine.slice(1)}`, 'info');
        }

        // Categories Functions
        function renderCategories() {
            categoriesContainer.innerHTML = '';
            categorySelect.innerHTML = '<option value="">Select Category</option>';

            Object.keys(categories).forEach(categoryName => {
                // Main categories display
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                
                categoryCard.innerHTML = `
                    <div class="category-header">
                        <input type="checkbox" class="category-checkbox" data-category="${categoryName}" checked>
                        <div class="category-title">${categoryName}</div>
                        <span class="website-count">${categories[categoryName].length}</span>
                        <span class="dropdown-icon">▼</span>
                    </div>
                    <div class="websites-list">
                        ${categories[categoryName].map((site, index) => `
                            <div class="website-item">
                                <span>${site.name}</span>
                                <div>
                                    <button class="btn btn-small" onclick="editWebsite('${categoryName}', ${index})">Edit</button>
                                    <button class="btn btn-danger btn-small" onclick="deleteWebsite('${categoryName}', ${index})">Delete</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;

                // Toggle dropdown
                const header = categoryCard.querySelector('.category-header');
                const websitesList = categoryCard.querySelector('.websites-list');
                const dropdownIcon = categoryCard.querySelector('.dropdown-icon');
                
                header.addEventListener('click', (e) => {
                    if (e.target.type !== 'checkbox') {
                        websitesList.classList.toggle('visible');
                        dropdownIcon.classList.toggle('rotated');
                    }
                });

                // Handle category selection
                const checkbox = categoryCard.querySelector('.category-checkbox');
                checkbox.addEventListener('change', (e) => {
                    categoryCard.classList.toggle('selected', e.target.checked);
                });

                categoriesContainer.appendChild(categoryCard);

                // Category select dropdown
                const option = document.createElement('option');
                option.value = categoryName;
                option.textContent = categoryName;
                categorySelect.appendChild(option);
            });

            renderManageCategories();
        }

        function renderManageCategories() {
            manageCategoriesContainer.innerHTML = '';

            Object.keys(categories).forEach(categoryName => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'glass-panel';
                categoryDiv.style.marginBottom = '20px';
                
                categoryDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: var(--brand-primary); margin: 0;">${categoryName}</h4>
                        <div>
                            <button class="btn btn-small" onclick="editCategory('${categoryName}')">Edit</button>
                            <button class="btn btn-danger btn-small" onclick="deleteCategory('${categoryName}')">Delete</button>
                        </div>
                    </div>
                    <div style="color: var(--text-secondary);">${categories[categoryName].length} websites</div>
                `;

                manageCategoriesContainer.appendChild(categoryDiv);
            });
        }

        // Management Functions
        window.editCategory = function(oldName) {
            const newName = prompt('Edit category name:', oldName);
            if (!newName || newName.trim() === '' || newName === oldName) return;
            
            if (categories[newName]) {
                showNotification('Category name already exists', 'error');
                return;
            }
            
            categories[newName] = categories[oldName];
            delete categories[oldName];
            renderCategories();
            showNotification('Category updated successfully', 'success');
        };

        window.deleteCategory = function(categoryName) {
            if (!confirm(`Delete category "${categoryName}" and all its websites?`)) return;
            
            delete categories[categoryName];
            renderCategories();
            showNotification('Category deleted successfully', 'success');
        };

        window.editWebsite = function(categoryName, index) {
            const site = categories[categoryName][index];
            const newName = prompt('Edit website name:', site.name);
            if (!newName || newName.trim() === '') return;
            
            const newUrl = prompt('Edit website URL:', site.url);
            if (!newUrl || newUrl.trim() === '') return;
            
            try {
                new URL(newUrl);
                categories[categoryName][index] = { name: newName, url: newUrl };
                renderCategories();
                showNotification('Website updated successfully', 'success');
            } catch {
                showNotification('Please enter a valid URL', 'error');
            }
        };

        window.deleteWebsite = function(categoryName, index) {
            const site = categories[categoryName][index];
            if (!confirm(`Delete website "${site.name}"?`)) return;
            
            categories[categoryName].splice(index, 1);
            renderCategories();
            showNotification('Website deleted successfully', 'success');
        };

        // Search Functions
        function performSearch() {
            const keyword = searchInput.value.trim();
            if (!keyword) {
                showNotification('Please enter a search keyword', 'error');
                return;
            }

            const selectedCategories = Array.from(document.querySelectorAll('.category-checkbox:checked'))
                .map(cb => cb.dataset.category);

            if (selectedCategories.length === 0) {
                showNotification('Please select at least one category', 'error');
                return;
            }

            const filters = {
                linkedinLocation: document.getElementById('linkedinLocation').value.trim(),
                linkedinJobTitle: document.getElementById('linkedinJobTitle').value.trim(),
                linkedinCompany: document.getElementById('linkedinCompany').value.trim(),
                linkedinSchool: document.getElementById('linkedinSchool').value.trim(),
                facebookLocation: document.getElementById('facebookLocation').value.trim(),
                facebookEducation: document.getElementById('facebookEducation').value.trim(),
                facebookWorkplace: document.getElementById('facebookWorkplace').value.trim(),
                facebookRelationship: document.getElementById('facebookRelationship').value
            };

            resultsContainer.innerHTML = '<div style="text-align: center; padding: 40px;"><div style="font-size: 2rem;">🔍</div><div>Searching...</div></div>';

            setTimeout(() => {
                const results = [];
                
                selectedCategories.forEach(categoryName => {
                    categories[categoryName].forEach(site => {
                        const searchURL = buildSearchURL(site, keyword, filters);
                        const relevanceScore = Math.floor(Math.random() * 10) + 1;
                        
                        results.push({
                            category: categoryName,
                            site: site,
                            searchURL: searchURL,
                            relevanceScore: relevanceScore
                        });
                    });
                });

                results.sort((a, b) => b.relevanceScore - a.relevanceScore);

                resultsContainer.innerHTML = '';
                
                results.forEach(result => {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'result-item';
                    
                    resultDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div>
                                <h4 style="color: var(--brand-primary); margin: 0 0 5px 0;">${result.site.name}</h4>
                                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">
                                    Category: ${result.category} • Relevance: ${result.relevanceScore}/10
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <strong>Search Query:</strong> "${keyword}"
                                </div>
                                ${Object.values(filters).some(f => f) ? `
                                    <div style="background: rgba(177, 63, 23, 0.1); padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                                        <strong>Applied Filters:</strong><br>
                                        ${Object.entries(filters).filter(([k, v]) => v).map(([k, v]) => `${k.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}: ${v}`).join('<br>')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        <a href="${result.searchURL}" target="_blank" class="btn btn-secondary">
                            🔗 Open Search
                        </a>
                    `;
                    
                    resultsContainer.appendChild(resultDiv);
                });

                // Save case
                saveCase(keyword, selectedCategories, filters, results);
                showNotification(`Search completed! Found ${results.length} sources`, 'success');
            }, 1500);
        }

        // Cases Management
        function saveCase(keyword, categories, filters, results) {
            const caseData = {
                id: Date.now(),
                keyword: keyword,
                categories: categories,
                filters: filters,
                results: results,
                timestamp: new Date().toISOString(),
                date: new Date().toLocaleDateString()
            };

            savedCases.unshift(caseData);
            if (savedCases.length > 50) savedCases = savedCases.slice(0, 50);
            
            renderCases();
        }

        function renderCases(filterText = '') {
            const filteredCases = savedCases.filter(c => 
                c.keyword.toLowerCase().includes(filterText.toLowerCase()) ||
                c.date.includes(filterText)
            );

            casesContainer.innerHTML = '';

            if (filteredCases.length === 0) {
                casesContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No saved cases found</p>';
                return;
            }

            filteredCases.forEach(caseData => {
                const caseDiv = document.createElement('div');
                caseDiv.className = 'case-item';
                
                caseDiv.innerHTML = `
                    <div>
                        <div style="font-weight: 600; color: var(--brand-primary); margin-bottom: 5px;">
                            "${caseData.keyword}"
                        </div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">
                            ${caseData.date} • ${caseData.categories.length} categories • ${caseData.results.length} results
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-small" onclick="loadCase(${caseData.id})">Load</button>
                        <button class="btn btn-danger btn-small" onclick="deleteCase(${caseData.id})">Delete</button>
                    </div>
                `;
                
                casesContainer.appendChild(caseDiv);
            });
        }

        window.loadCase = function(caseId) {
            const caseData = savedCases.find(c => c.id === caseId);
            if (!caseData) return;

            searchInput.value = caseData.keyword;
            
            // Restore filters
            Object.entries(caseData.filters).forEach(([key, value]) => {
                const element = document.getElementById(key);
                if (element) element.value = value || '';
            });

            // Restore category selections
            document.querySelectorAll('.category-checkbox').forEach(cb => {
                cb.checked = caseData.categories.includes(cb.dataset.category);
                cb.closest('.category-card').classList.toggle('selected', cb.checked);
            });

            // Restore results
            resultsContainer.innerHTML = '';
            caseData.results.forEach(result => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result-item';
                
                resultDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                        <div>
                            <h4 style="color: var(--brand-primary); margin: 0 0 5px 0;">${result.site.name}</h4>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 10px;">
                                Category: ${result.category} • Relevance: ${result.relevanceScore}/10
                            </div>
                        </div>
                    </div>
                    <a href="${result.searchURL}" target="_blank" class="btn btn-secondary">
                        🔗 Open Search
                    </a>
                `;
                
                resultsContainer.appendChild(resultDiv);
            });

            showNotification('Case loaded successfully', 'success');
        };

        window.deleteCase = function(caseId) {
            if (!confirm('Delete this case?')) return;
            
            savedCases = savedCases.filter(c => c.id !== caseId);
            renderCases(searchCasesInput.value);
            showNotification('Case deleted', 'success');
        };

        // Export Functions
        function exportReport() {
            if (!resultsContainer.innerHTML.trim() || resultsContainer.innerHTML.includes('Enter keywords')) {
                showNotification('No results to export', 'error');
                return;
            }

            const timestamp = new Date().toLocaleString();
            const keyword = searchInput.value.trim();
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>OSINT Report - ${keyword}</title>
                    <meta charset="UTF-8">
                    <style>
                        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 30px; max-width: 800px; margin: 0 auto; }
                        h1 { color: #B13F17; border-bottom: 3px solid #B13F17; padding-bottom: 10px; }
                        .result-item { margin-bottom: 25px; padding: 15px; border: 1px solid #e9ecef; border-radius: 8px; }
                        a { color: #B13F17; text-decoration: none; }
                        .header-info { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
                    </style>
                </head>
                <body>
                    <div class="header-info">
                        <h1>🔍 OSINT Search Report</h1>
                        <h2>Search Query: "${keyword}"</h2>
                        <p>Generated: ${timestamp}</p>
                    </div>
                    ${resultsContainer.innerHTML}
                    <div style="margin-top: 40px; color: #666; font-size: 0.9em;">
                        <p>Report generated by Modern OSINT Search Tool</p>
                        <p>⚠️ Verify all information through multiple sources</p>
                    </div>
                </body>
                </html>
            `;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `OSINT_Report_${keyword.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Report exported successfully', 'success');
        }

        // Event Listeners
        function setupEventListeners() {
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });

            selectAllBtn.addEventListener('click', () => {
                document.querySelectorAll('.category-checkbox').forEach(cb => {
                    cb.checked = true;
                    cb.closest('.category-card').classList.add('selected');
                });
                showNotification('All categories selected', 'success');
            });

            deselectAllBtn.addEventListener('click', () => {
                document.querySelectorAll('.category-checkbox').forEach(cb => {
                    cb.checked = false;
                    cb.closest('.category-card').classList.remove('selected');
                });
                showNotification('All categories deselected', 'info');
            });

            addCategoryBtn.addEventListener('click', () => {
                const name = newCategoryInput.value.trim();
                if (!name) {
                    showNotification('Please enter a category name', 'error');
                    return;
                }
                if (categories[name]) {
                    showNotification('Category already exists', 'error');
                    return;
                }
                
                categories[name] = [];
                newCategoryInput.value = '';
                renderCategories();
                showNotification('Category added successfully', 'success');
            });

            addWebsiteBtn.addEventListener('click', () => {
                const category = categorySelect.value;
                const name = websiteName.value.trim();
                const url = websiteURL.value.trim();
                
                if (!category || !name || !url) {
                    showNotification('Please fill all fields', 'error');
                    return;
                }
                
                try {
                    new URL(url);
                    categories[category].push({ name, url });
                    websiteName.value = '';
                    websiteURL.value = '';
                    renderCategories();
                    showNotification('Website added successfully', 'success');
                } catch {
                    showNotification('Please enter a valid URL', 'error');
                }
            });

            exportBtn.addEventListener('click', exportReport);

            searchCasesInput.addEventListener('input', (e) => {
                renderCases(e.target.value);
            });

            clearCasesBtn.addEventListener('click', () => {
                if (!confirm('Clear all saved cases?')) return;
                savedCases = [];
                renderCases();
                showNotification('All cases cleared', 'success');
            });

            scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        // Initialize Application
        function init() {
            setupImageUpload();
            setupSearchEngines();
            setupEventListeners();
            renderCategories();
            renderCases();
            
            showNotification('Modern OSINT Tool loaded successfully!', 'success');
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>