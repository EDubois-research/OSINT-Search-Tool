<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced OSINT Search Tool</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fff;
      color: #222;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px;
    }
    section {
      background: #f0e6e1;
      border-radius: 12px;
      padding: 24px 24px 18px 24px;
      margin-bottom: 32px;
    }
    h1, h2, h3 {
      color: #B13F17;
      margin-bottom: 12px;
      font-weight: 700;
    }
    h1 {
      font-size: 2.4rem;
      margin-top: 0;
    }
    h2 {
      font-size: 1.5rem;
    }
    h3 {
      font-size: 1.1rem;
    }
    .btn, button, input[type="submit"] {
      background: #B13F17;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 22px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      margin: 0 4px 0 0;
      outline: none;
      box-shadow: none;
    }
    .btn:hover, button:hover, input[type="submit"]:hover {
      background: #8a2e11;
    }
    .btn-small {
      padding: 6px 14px;
      font-size: 0.95rem;
      border-radius: 4px;
    }
    .btn-danger {
      background: #dc3545;
      color: #fff;
    }
    .btn-danger:hover {
      background: #c82333;
    }
    .btn-success {
      background: #28a745;
      color: #fff;
    }
    .btn-success:hover {
      background: #218838;
    }
    input, select, textarea {
      padding: 10px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      margin-bottom: 8px;
      background: #fff;
      color: #222;
      outline: none;
      box-shadow: none;
      transition: border 0.2s;
    }
    input:focus, select:focus, textarea:focus {
      border: 1.5px solid #B13F17;
    }
    .search-container {
      display: flex;
      gap: 12px;
      margin-bottom: 18px;
    }
    .search-container input {
      flex: 1;
    }
    .advanced-options {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      border: 1px solid #ddd;
    }
    .categories-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
      margin-bottom: 18px;
    }
    .category-card {
      background: #fff;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.2s;
    }
    .category-card:hover {
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .category-checkbox {
      width: 18px;
      height: 18px;
      accent-color: #B13F17;
    }
    .category-title {
      font-size: 1.08rem;
      font-weight: 600;
      color: #B13F17;
      flex-grow: 1;
    }
    .website-count {
      background: #f0e6e1;
      color: #B13F17;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .search-progress {
      background: #fff;
      border-radius: 10px;
      padding: 25px;
      margin: 20px 0;
      text-align: center;
      border: 2px solid #e9ecef;
    }
    .progress-bar {
      width: 100%;
      height: 24px;
      background: #e9ecef;
      border-radius: 12px;
      overflow: hidden;
      margin: 15px 0;
      position: relative;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #B13F17, #d4691a);
      width: 0%;
      transition: width 0.5s ease;
      border-radius: 12px;
    }
    .progress-text {
      font-weight: 600;
      color: #B13F17;
      margin: 10px 0;
    }
    .results-container {
      margin-top: 20px;
    }
    .result-item {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      border: 1px solid #e9ecef;
      transition: all 0.2s;
    }
    .result-item:hover {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .result-match {
      border-left: 5px solid #28a745;
      background: linear-gradient(135deg, #f8fff8 0%, #ffffff 100%);
    }
    .result-no-match {
      border-left: 5px solid #dc3545;
      background: linear-gradient(135deg, #fff8f8 0%, #ffffff 100%);
      opacity: 0.8;
    }
    .result-error {
      border-left: 5px solid #ffc107;
      background: linear-gradient(135deg, #fffdf0 0%, #ffffff 100%);
    }
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    .result-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #B13F17;
      margin-bottom: 5px;
    }
    .result-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }
    .status-icon {
      font-size: 1.2rem;
    }
    .result-details {
      margin: 12px 0;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
      font-size: 0.95rem;
    }
    .match-snippet {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 10px;
      border-radius: 6px;
      margin: 8px 0;
      font-style: italic;
      color: #856404;
    }
    .result-links {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 15px;
    }
    .result-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 12px 0;
      font-size: 0.9rem;
    }
    .meta-item {
      display: flex;
      flex-direction: column;
    }
    .meta-label {
      font-weight: 600;
      color: #666;
      margin-bottom: 2px;
    }
    .meta-value {
      color: #333;
    }
    .score-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 20px;
      font-weight: 700;
      font-size: 0.85rem;
    }
    .score-high {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .score-medium {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }
    .score-low {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .filters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    .filter-section {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
    }
    .filter-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: #B13F17;
      margin-bottom: 12px;
    }
    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #e9ecef;
    }
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: #B13F17;
      margin-bottom: 5px;
    }
    .stat-label {
      color: #666;
      font-weight: 600;
    }
    .highlight {
      background: #fff3cd;
      color: #856404;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: 600;
    }
    @media (max-width: 768px) {
      .container { padding: 15px; }
      .categories-grid { grid-template-columns: 1fr; }
      .result-meta { grid-template-columns: 1fr; }
      .summary-stats { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    <header style="text-align:center; margin-bottom:40px;">
      <h1>üïµÔ∏è Advanced OSINT Search Tool</h1>
      <p style="color:#666; font-size:1.2rem;">Professional Open Source Intelligence Investigation Platform</p>
    </header>

    <!-- Search Section -->
    <section>
      <h2>üîç Primary Search</h2>
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Enter person name, company, email, phone, etc...">
        <button id="searchBtn" class="btn">üöÄ Start Investigation</button>
      </div>
      
      <div class="advanced-options">
        <h3>üéØ Search Options</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <label>
            <input type="checkbox" id="deepSearch" checked> Deep Content Analysis
          </label>
          <label>
            <input type="checkbox" id="followRedirects" checked> Follow Redirects
          </label>
          <label>
            <input type="checkbox" id="extractEmails"> Extract Email Addresses
          </label>
          <label>
            <input type="checkbox" id="extractPhones"> Extract Phone Numbers
          </label>
          <label>
            <input type="number" id="maxResults" placeholder="Max results per site" min="1" max="50" value="10" style="width: 100px;"> Max Results
          </label>
          <label>
            <select id="searchMode">
              <option value="comprehensive">Comprehensive Search</option>
              <option value="quick">Quick Search</option>
              <option value="targeted">Targeted Search</option>
            </select>
          </label>
        </div>
      </div>
    </section>

    <!-- Advanced Filters -->
    <section>
      <h2>‚öôÔ∏è Advanced Filters</h2>
      <div class="filters-grid">
        <div class="filter-section">
          <div class="filter-title">üíº Professional Networks</div>
          <input type="text" id="linkedinLocation" placeholder="Location (e.g., London, UK)">
          <input type="text" id="linkedinCompany" placeholder="Current/Previous Company">
          <input type="text" id="linkedinTitle" placeholder="Job Title/Role">
          <input type="text" id="linkedinSchool" placeholder="Education/University">
        </div>
        <div class="filter-section">
          <div class="filter-title">üì± Social Media</div>
          <input type="text" id="socialLocation" placeholder="Location">
          <input type="text" id="socialAge" placeholder="Age Range (e.g., 25-35)">
          <select id="socialGender">
            <option value="">Any Gender</option>
            <option value="male">Male</option>
            <option value="female">Female</option>
          </select>
          <input type="text" id="socialInterests" placeholder="Interests/Hobbies">
        </div>
        <div class="filter-section">
          <div class="filter-title">üè¢ Business/Legal</div>
          <input type="text" id="businessRole" placeholder="Director/Officer Role">
          <input type="text" id="businessSector" placeholder="Industry/Sector">
          <input type="date" id="dateFrom" placeholder="From Date">
          <input type="date" id="dateTo" placeholder="To Date">
        </div>
      </div>
    </section>

    <!-- Categories Section -->
    <section>
      <h2>üìã Investigation Categories</h2>
      <div class="categories-grid" id="categoriesContainer">
        <!-- Categories will be populated here -->
      </div>
      <div style="margin-top: 20px;">
        <button class="btn btn-small" id="selectAllBtn">‚úÖ Select All</button>
        <button class="btn btn-small" id="deselectAllBtn">‚ùå Deselect All</button>
        <button class="btn btn-small" id="selectRecommendedBtn">üéØ Recommended Only</button>
      </div>
    </section>

    <!-- Results Section -->
    <section>
      <h2>üìä Investigation Results</h2>
      <div id="searchSummary" style="display: none;">
        <div class="summary-stats">
          <div class="stat-card">
            <div class="stat-number" id="totalSearched">0</div>
            <div class="stat-label">Sites Searched</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalMatches">0</div>
            <div class="stat-label">Matches Found</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="avgScore">0</div>
            <div class="stat-label">Avg. Relevance</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="successRate">0%</div>
            <div class="stat-label">Success Rate</div>
          </div>
        </div>
      </div>
      
      <div id="resultsContainer" class="results-container">
        <div style="text-align: center; color: #666; padding: 60px 20px;">
          <div style="font-size: 3rem; margin-bottom: 20px;">üîç</div>
          <h3>Ready to Start Investigation</h3>
          <p>Enter your search terms and select categories to begin comprehensive OSINT analysis</p>
        </div>
      </div>
      
      <div style="margin-top: 25px; display: none;" id="exportSection">
        <button class="btn" id="exportBtn">üìã Export Detailed Report</button>
        <button class="btn" id="saveCase">üíæ Save Investigation</button>
      </div>
    </section>
  </div>

  <script>
    // Enhanced OSINT Tool with Real Scraping Capabilities
    
    let categories = {};
    let lastResults = [];
    let currentSearch = null;

    // Comprehensive site database with search patterns
    const siteDatabase = {
      "Professional Networks": [
        {
          name: "LinkedIn Profiles",
          baseUrl: "https://www.linkedin.com",
          searchUrl: "https://www.linkedin.com/search/results/people/?keywords={QUERY}",
          patterns: {
            profile: /linkedin\.com\/in\/([^\/\?]+)/g,
            company: /linkedin\.com\/company\/([^\/\?]+)/g
          },
          selectors: {
            results: '.search-result__wrapper',
            title: '.search-result__result-link',
            snippet: '.search-result__snippets'
          },
          weight: 9
        },
        {
          name: "Companies House UK",
          baseUrl: "https://find-and-update.company-information.service.gov.uk",
          searchUrl: "https://find-and-update.company-information.service.gov.uk/search/companies?q={QUERY}",
          patterns: {
            company: /\/company\/([A-Z0-9]{8})/g,
            officer: /officers\/([^\/]+)/g
          },
          selectors: {
            results: '.search-result',
            title: 'h3 a',
            snippet: '.search-result-summary'
          },
          weight: 10
        }
      ],
      "Social Media": [
        {
          name: "Facebook Search",
          baseUrl: "https://www.facebook.com",
          searchUrl: "https://www.facebook.com/search/people/?q={QUERY}",
          patterns: {
            profile: /facebook\.com\/([^\/\?]+)/g
          },
          selectors: {
            results: '[data-testid="search_result"]',
            title: 'a[role="link"]',
            snippet: 'div[data-testid="search_result"] div'
          },
          weight: 7
        },
        {
          name: "Twitter/X Search",
          baseUrl: "https://twitter.com",
          searchUrl: "https://twitter.com/search?q={QUERY}&src=typed_query&f=user",
          patterns: {
            profile: /twitter\.com\/([^\/\?]+)/g
          },
          selectors: {
            results: '[data-testid="UserCell"]',
            title: '[data-testid="UserName"]',
            snippet: '[data-testid="UserDescription"]'
          },
          weight: 8
        }
      ],
      "Court Records": [
        {
          name: "BAILII Legal Database",
          baseUrl: "https://www.bailii.org",
          searchUrl: "https://www.bailii.org/cgi-bin/markup.cgi?doc=/bailii/search.html&query={QUERY}",
          patterns: {
            case: /bailii\.org\/[^\/]+\/cases\/[^\/]+\/([^\.]+)\.html/g
          },
          selectors: {
            results: '.search-result',
            title: 'a.title',
            snippet: '.snippet'
          },
          weight: 9
        }
      ],
      "Professional Registers": [
        {
          name: "GMC Medical Register",
          baseUrl: "https://www.gmc-uk.org",
          searchUrl: "https://www.gmc-uk.org/doctors?query={QUERY}",
          patterns: {
            doctor: /doctors\/([0-9]+)/g
          },
          selectors: {
            results: '.doctor-result',
            title: '.doctor-name',
            snippet: '.doctor-details'
          },
          weight: 10
        },
        {
          name: "SRA Solicitors",
          baseUrl: "https://www.sra.org.uk",
          searchUrl: "https://www.sra.org.uk/consumers/register/search?name={QUERY}",
          patterns: {
            solicitor: /sra\.org\.uk\/solicitors\/([^\/]+)/g
          },
          selectors: {
            results: '.search-result',
            title: '.solicitor-name',
            snippet: '.solicitor-details'
          },
          weight: 10
        }
      ]
    };

    // Initialize categories from database
    function initializeCategories() {
      categories = {};
      Object.keys(siteDatabase).forEach(categoryName => {
        categories[categoryName] = siteDatabase[categoryName];
      });
      renderCategories();
    }

    // Advanced content scraping with proxy
    class WebScraper {
      constructor() {
        this.proxies = [
          'https://api.allorigins.win/get?url=',
          'https://cors-anywhere.herokuapp.com/',
          'https://proxy.cors.sh/'
        ];
        this.currentProxy = 0;
      }

      async fetchWithProxy(url, maxRetries = 3) {
        for (let i = 0; i < maxRetries; i++) {
          try {
            const proxyUrl = this.proxies[this.currentProxy] + encodeURIComponent(url);
            const response = await fetch(proxyUrl, {
              method: 'GET',
              headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
                'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
              }
            });

            if (response.ok) {
              const data = await response.json();
              return data.contents || data;
            }
          } catch (error) {
            console.warn(`Proxy ${this.currentProxy} failed:`, error.message);
            this.currentProxy = (this.currentProxy + 1) % this.proxies.length;
          }
        }
        throw new Error('All proxies failed');
      }

      async searchSite(site, query, options = {}) {
        try {
          const searchUrl = site.searchUrl.replace('{QUERY}', encodeURIComponent(query));
          console.log(`Searching ${site.name}: ${searchUrl}`);
          
          const html = await this.fetchWithProxy(searchUrl);
          return this.analyzeSiteContent(site, html, query, searchUrl);
        } catch (error) {
          console.error(`Error searching ${site.name}:`, error);
          return {
            site: site.name,
            hasMatch: false,
            error: error.message,
            relevanceScore: 0,
            results: [],
            searchUrl: site.searchUrl.replace('{QUERY}', encodeURIComponent(query))
          };
        }
      }

      analyzeSiteContent(site, html, query, searchUrl) {
        if (!html) {
          return {
            site: site.name,
            hasMatch: false,
            error: 'No content received',
            relevanceScore: 0,
            results: [],
            searchUrl: searchUrl
          };
        }

        // Create DOM parser
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Extract structured results
        const results = this.extractStructuredResults(doc, site, query);
        
        // Calculate relevance score
        const relevanceScore = this.calculateRelevanceScore(results, query, site);
        
        return {
          site: site.name,
          hasMatch: results.length > 0,
          relevanceScore: relevanceScore,
          results: results,
          searchUrl: searchUrl,
          totalFound: results.length,
          timestamp: new Date().toISOString()
        };
      }

      extractStructuredResults(doc, site, query) {
        const results = [];
        const maxResults = parseInt(document.getElementById('maxResults')?.value) || 10;

        try {
          // Use site-specific selectors
          const resultElements = doc.querySelectorAll(site.selectors?.results || '.search-result, .result, [class*="result"]');
          
          Array.from(resultElements).slice(0, maxResults).forEach((element, index) => {
            const result = this.extractSingleResult(element, site, query, index);
            if (result) {
              results.push(result);
            }
          });

          // If no structured results, try pattern matching
          if (results.length === 0) {
            const patternResults = this.extractPatternResults(doc.body.innerHTML, site, query);
            results.push(...patternResults.slice(0, maxResults));
          }

        } catch (error) {
          console.error('Error extracting results:', error);
        }

        return results;
      }

      extractSingleResult(element, site, query, index) {
        try {
          const titleElement = element.querySelector(site.selectors?.title || 'a, h1, h2, h3, .title');
          const snippetElement = element.querySelector(site.selectors?.snippet || '.snippet, .description, p');
          
          const title = titleElement?.textContent?.trim() || '';
          const snippet = snippetElement?.textContent?.trim() || '';
          const link = titleElement?.href || element.querySelector('a')?.href || '';

          // Skip if no meaningful content
          if (!title && !snippet) return null;

          // Skip if it's just navigation or search interface
          if (this.isNavigationElement(title + ' ' + snippet)) return null;

          // Extract specific data based on site patterns
          const extractedData = this.extractSpecificData(element.innerHTML, site);

          return {
            id: `${site.name}_${index}`,
            title: title,
            snippet: snippet,
            url: this.normalizeUrl(link, site.baseUrl),
            relevance: this.calculateItemRelevance(title + ' ' + snippet, query),
            extractedData: extractedData,
            confidence: this.calculateConfidence(title, snippet, query),
            source: site.name
          };
        } catch (error) {
          console.error('Error extracting single result:', error);
          return null;
        }
      }

      extractPatternResults(html, site, query) {
        const results = [];
        
        // Use site-specific patterns
        if (site.patterns) {
          Object.entries(site.patterns).forEach(([type, pattern]) => {
            const matches = html.match(pattern) || [];
            matches.forEach((match, index) => {
              if (results.length < 5) { // Limit pattern results
                results.push({
                  id: `${site.name}_pattern_${index}`,
                  title: `${type.charAt(0).toUpperCase() + type.slice(1)} found`,
                  snippet: match,
                  url: this.normalizeUrl(match, site.baseUrl),
                  relevance: 5,
                  extractedData: { type: type, match: match },
                  confidence: 'medium',
                  source: site.name
                });
              }
            });
          });
        }

        return results;
      }

      extractSpecificData(html, site) {
        const data = {};
        
        // Extract emails if option is enabled
        if (document.getElementById('extractEmails')?.checked) {
          const emailPattern = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g;
          data.emails = (html.match(emailPattern) || []).slice(0, 5);
        }

        // Extract phone numbers if option is enabled
        if (document.getElementById('extractPhones')?.checked) {
          const phonePattern = /(?:\+44|0)(?:[1-9]\d{8,9}|\d{10})/g;
          data.phones = (html.match(phonePattern) || []).slice(0, 5);
        }

        return data;
      }

      isNavigationElement(text) {
        const navKeywords = [
          'search for', 'enter search', 'search results', 'no results found',
          'navigation', 'menu', 'header', 'footer', 'cookie', 'privacy policy',
          'terms of service', 'login', 'register', 'sign up', 'sign in'
        ];
        
        const lowerText = text.toLowerCase();
        return navKeywords.some(keyword => lowerText.includes(keyword));
      }

      calculateItemRelevance(text, query) {
        const queryWords = query.toLowerCase().split(/\s+/);
        const textLower = text.toLowerCase();
        
        let score = 0;
        queryWords.forEach(word => {
          if (word.length > 2) {
            const exactMatches = (textLower.match(new RegExp(word, 'g')) || []).length;
            score += exactMatches * 2;
            
            // Partial matches
            if (textLower.includes(word)) {
              score += 1;
            }
          }
        });

        return Math.min(10, score);
      }

      calculateRelevanceScore(results, query, site) {
        if (results.length === 0) return 0;
        
        const avgItemRelevance = results.reduce((sum, r) => sum + (r.relevance || 0), 0) / results.length;
        const resultCountBonus = Math.min(results.length * 0.5, 3);
        const siteWeightBonus = site.weight || 5;
        
        return Math.min(10, Math.round(avgItemRelevance + resultCountBonus + (siteWeightBonus / 10)));
      }

      calculateConfidence(title, snippet, query) {
        const text = (title + ' ' + snippet).toLowerCase();
        const queryLower = query.toLowerCase();
        
        if (text.includes(queryLower)) return 'high';
        
        const queryWords = queryLower.split(/\s+/);
        const matchingWords = queryWords.filter(word => text.includes(word)).length;
        const matchRatio = matchingWords / queryWords.length;
        
        if (matchRatio > 0.7) return 'high';
        if (matchRatio > 0.4) return 'medium';
        return 'low';
      }

      normalizeUrl(url, baseUrl) {
        if (!url) return '';
        if (url.startsWith('http')) return url;
        if (url.startsWith('//')) return 'https:' + url;
        if (url.startsWith('/')) return baseUrl + url;
        return baseUrl + '/' + url;
      }
    }

    // Initialize scraper
    const scraper = new WebScraper();

    // DOM Elements
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const categoriesContainer = document.getElementById('categoriesContainer');
    const resultsContainer = document.getElementById('resultsContainer');
    const searchSummary = document.getElementById('searchSummary');
    const exportSection = document.getElementById('exportSection');

    // Utility Functions
    function showNotification(message, type = 'info') {
      // Remove existing notifications  
      document.querySelectorAll('.notification').forEach(n => n.remove());
      
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 10000;
        padding: 15px 25px; border-radius: 8px; font-weight: 600;
        color: white; opacity: 0; transition: opacity 0.3s;
        ${type === 'success' ? 'background: #28a745;' : 
          type === 'error' ? 'background: #dc3545;' : 
          type === 'warning' ? 'background: #ffc107; color: #212529;' :
          'background: #17a2b8;'}
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      setTimeout(() => notification.style.opacity = '1', 100);
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    function renderCategories() {
      categoriesContainer.innerHTML = '';
      
      Object.entries(categories).forEach(([categoryName, sites]) => {
        const categoryCard = document.createElement('div');
        categoryCard.className = 'category-card';
        categoryCard.innerHTML = `
          <input type="checkbox" class="category-checkbox" data-category="${categoryName}" checked>
          <div class="category-title">${categoryName}</div>
          <span class="website-count">${sites.length}</span>
        `;
        
        const checkbox = categoryCard.querySelector('.category-checkbox');
        checkbox.addEventListener('change', (e) => {
          categoryCard.style.opacity = e.target.checked ? '1' : '0.6';
        });
        
        categoriesContainer.appendChild(categoryCard);
      });
    }

    // Main search function
    async function performAdvancedSearch() {
      const query = searchInput.value.trim();
      if (!query) {
        showNotification('Please enter a search term', 'error');
        return;
      }

      const selectedCategories = Array.from(
        document.querySelectorAll('.category-checkbox:checked')
      ).map(cb => cb.dataset.category);

      if (selectedCategories.length === 0) {
        showNotification('Please select at least one category', 'error');
        return;
      }

      // Disable search button
      searchBtn.disabled = true;
      searchBtn.textContent = 'üîç Searching...';
      
      // Show progress
      showSearchProgress();
      
      // Collect all sites to search
      const sitesToSearch = [];
      selectedCategories.forEach(category => {
        categories[category].forEach(site => {
          sitesToSearch.push({...site, category});
        });
      });

      const results = [];
      const total = sitesToSearch.length;
      let completed = 0;

      // Search each site
      for (const site of sitesToSearch) {
        if (currentSearch?.aborted) break;
        
        updateProgress(completed, total, `Searching ${site.name}...`);
        
        try {
          const result = await scraper.searchSite(site, query, getSearchOptions());
          result.category = site.category;
          results.push(result);
        } catch (error) {
          console.error(`Failed to search ${site.name}:`, error);
          results.push({
            site: site.name,
            category: site.category,
            hasMatch: false,
            error: error.message,
            relevanceScore: 0,
            results: []
          });
        }
        
        completed++;
        await new Promise(resolve => setTimeout(resolve, 300)); // Rate limiting
      }

      // Process and display results
      if (!currentSearch?.aborted) {
        lastResults = results.sort((a, b) => b.relevanceScore - a.relevanceScore);
        displayResults(lastResults, query);
        updateSearchSummary(lastResults);
        showNotification(`Search completed! Found ${results.filter(r => r.hasMatch).length} matches`, 'success');
      }

      // Re-enable search
      searchBtn.disabled = false;
      searchBtn.textContent = 'üöÄ Start Investigation';
      currentSearch = null;
    }

    function getSearchOptions() {
      return {
        deepSearch: document.getElementById('deepSearch')?.checked || false,
        followRedirects: document.getElementById('followRedirects')?.checked || false,
        extractEmails: document.getElementById('extractEmails')?.checked || false,
        extractPhones: document.getElementById('extractPhones')?.checked || false,
        maxResults: parseInt(document.getElementById('maxResults')?.value) || 10,
        searchMode: document.getElementById('searchMode')?.value || 'comprehensive'
      };
    }

    function showSearchProgress() {
      const progressHtml = `
        <div class="search-progress">
          <div style="font-size: 1.3rem; margin-bottom: 15px;">üîç Advanced OSINT Investigation in Progress</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text" id="progressText">Initializing search...</div>
          <div style="margin-top: 15px;">
            <button class="btn btn-danger btn-small" id="abortSearch">‚èπÔ∏è Abort Search</button>
          </div>
        </div>
      `;
      
      resultsContainer.innerHTML = progressHtml;
      
      currentSearch = { aborted: false };
      document.getElementById('abortSearch').addEventListener('click', () => {
        currentSearch.aborted = true;
        showNotification('Search aborted by user', 'warning');
        searchBtn.disabled = false;
        searchBtn.textContent = 'üöÄ Start Investigation';
      });
    }

    function updateProgress(completed, total, message) {
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      
      if (progressFill && progressText) {
        const percentage = (completed / total) * 100;
        progressFill.style.width = `${percentage}%`;
        progressText.textContent = `${message} (${completed}/${total})`;
      }
    }

    function displayResults(results, query) {
      resultsContainer.innerHTML = '';
      
      if (results.length === 0) {
        resultsContainer.innerHTML = `
          <div style="text-align: center; padding: 40px; color: #666;">
            <div style="font-size: 3rem;">‚ùå</div>
            <h3>No Results Found</h3>
            <p>Try adjusting your search terms or selecting different categories</p>
          </div>
        `;
        return;
      }

      // Group results by category
      const grouped = {};
      results.forEach(result => {
        if (!grouped[result.category]) grouped[result.category] = [];
        grouped[result.category].push(result);
      });

      Object.entries(grouped).forEach(([category, categoryResults]) => {
        const categorySection = document.createElement('div');
        categorySection.innerHTML = `
          <h3 style="color: #B13F17; margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 2px solid #eee;">
            üìÅ ${category} (${categoryResults.filter(r => r.hasMatch).length}/${categoryResults.length} matches)
          </h3>
        `;
        
        categoryResults.forEach(result => {
          const resultElement = createResultElement(result, query);
          categorySection.appendChild(resultElement);
        });
        
        resultsContainer.appendChild(categorySection);
      });

      // Show export section
      exportSection.style.display = 'block';
    }

    function createResultElement(result, query) {
      const hasResults = result.hasMatch && result.results && result.results.length > 0;
      const statusClass = result.error ? 'result-error' : (hasResults ? 'result-match' : 'result-no-match');
      const statusIcon = result.error ? '‚ö†Ô∏è' : (hasResults ? '‚úÖ' : '‚ùå');
      const statusText = result.error ? 'Error' : (hasResults ? 'Match Found' : 'No Match');

      const element = document.createElement('div');
      element.className = `result-item ${statusClass}`;
      
      let content = `
        <div class="result-header">
          <div>
            <div class="result-title">${result.site}</div>
            <div class="result-status">
              <span class="status-icon">${statusIcon}</span>
              <span>${statusText}</span>
              ${result.relevanceScore > 0 ? 
                `<span class="score-badge ${getScoreClass(result.relevanceScore)}">
                  Relevance: ${result.relevanceScore}/10
                </span>` : ''}
            </div>
          </div>
        </div>
      `;

      if (result.error) {
        content += `
          <div class="result-details">
            <strong>Error:</strong> ${result.error}
          </div>
        `;
      } else if (hasResults) {
        content += `
          <div class="result-meta">
            <div class="meta-item">
              <div class="meta-label">Results Found</div>
              <div class="meta-value">${result.results.length}</div>
            </div>
            <div class="meta-item">
              <div class="meta-label">Search Time</div>
              <div class="meta-value">${new Date(result.timestamp).toLocaleTimeString()}</div>
            </div>
            ${result.totalFound ? `
            <div class="meta-item">
              <div class="meta-label">Total Matches</div>
              <div class="meta-value">${result.totalFound}</div>
            </div>
            ` : ''}
          </div>
        `;

        // Show top results
        const topResults = result.results.slice(0, 3);
        topResults.forEach((item, index) => {
          content += `
            <div class="result-details" style="margin-top: 15px;">
              <div style="font-weight: 600; color: #B13F17; margin-bottom: 8px;">
                üìÑ Result ${index + 1}: ${highlightKeywords(item.title, query)}
              </div>
              ${item.snippet ? `
                <div class="match-snippet">
                  ${highlightKeywords(item.snippet, query)}
                </div>
              ` : ''}
              ${item.extractedData && Object.keys(item.extractedData).length > 0 ? `
                <div style="font-size: 0.9rem; color: #666; margin-top: 8px;">
                  <strong>Extracted Data:</strong> 
                  ${Object.entries(item.extractedData).map(([key, value]) => 
                    `${key}: ${Array.isArray(value) ? value.join(', ') : value}`
                  ).join(' | ')}
                </div>
              ` : ''}
              <div class="result-links" style="margin-top: 10px;">
                ${item.url ? `<a href="${item.url}" target="_blank" class="btn btn-success btn-small">üîó View Result</a>` : ''}
                <span style="margin-left: 10px; font-size: 0.9rem; color: #666;">
                  Confidence: ${item.confidence || 'medium'} | Relevance: ${item.relevance || 0}/10
                </span>
              </div>
            </div>
          `;
        });

        if (result.results.length > 3) {
          content += `
            <div style="margin-top: 15px; text-align: center;">
              <button class="btn btn-small" onclick="showAllResults('${result.site}')">
                üìã Show All ${result.results.length} Results
              </button>
            </div>
          `;
        }
      }

      // Always show search URL
      content += `
        <div class="result-links" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
          <a href="${result.searchUrl}" target="_blank" class="btn btn-small">üîç Open Search Page</a>
        </div>
      `;

      element.innerHTML = content;
      return element;
    }

    function getScoreClass(score) {
      if (score >= 8) return 'score-high';
      if (score >= 5) return 'score-medium';
      return 'score-low';
    }

    function highlightKeywords(text, query) {
      if (!text || !query) return text;
      
      const keywords = query.split(/\s+/).filter(word => word.length > 2);
      let highlightedText = text;
      
      keywords.forEach(keyword => {
        const regex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\        const matchR')})`, 'gi');
        highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>');
      });
      
      return highlightedText;
    }

    function updateSearchSummary(results) {
      const totalSearched = results.length;
      const totalMatches = results.filter(r => r.hasMatch).length;
      const avgScore = results.length > 0 ? 
        (results.reduce((sum, r) => sum + r.relevanceScore, 0) / results.length).toFixed(1) : 0;
      const successRate = totalSearched > 0 ? 
        ((totalMatches / totalSearched) * 100).toFixed(0) : 0;

      document.getElementById('totalSearched').textContent = totalSearched;
      document.getElementById('totalMatches').textContent = totalMatches;
      document.getElementById('avgScore').textContent = avgScore;
      document.getElementById('successRate').textContent = successRate + '%';
      
      searchSummary.style.display = 'block';
    }

    // Global function for showing all results
    window.showAllResults = function(siteName) {
      const siteResult = lastResults.find(r => r.site === siteName);
      if (!siteResult || !siteResult.results) return;

      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed; top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.8); z-index: 10000;
        display: flex; align-items: center; justify-content: center;
        padding: 20px;
      `;
      
      const content = document.createElement('div');
      content.style.cssText = `
        background: white; border-radius: 10px; padding: 30px;
        max-width: 800px; max-height: 80vh; overflow-y: auto;
        width: 100%;
      `;
      
      let html = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="color: #B13F17; margin: 0;">All Results from ${siteName}</h2>
          <button onclick="this.closest('[style*=\"position: fixed\"]').remove()" 
                  style="background: #dc3545; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer;">
            ‚úï Close
          </button>
        </div>
      `;
      
      siteResult.results.forEach((result, index) => {
        html += `
          <div style="border: 1px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
            <h4 style="color: #B13F17; margin-top: 0;">${result.title}</h4>
            ${result.snippet ? `<p style="color: #666;">${result.snippet}</p>` : ''}
            ${result.url ? `
              <a href="${result.url}" target="_blank" class="btn btn-success btn-small">
                üîó View Result
              </a>
            ` : ''}
            <div style="margin-top: 10px; font-size: 0.9rem; color: #999;">
              Relevance: ${result.relevance}/10 | Confidence: ${result.confidence}
            </div>
          </div>
        `;
      });
      
      content.innerHTML = html;
      modal.appendChild(content);
      document.body.appendChild(modal);
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
      });
    };

    // Event Listeners
    function setupEventListeners() {
      searchBtn.addEventListener('click', performAdvancedSearch);
      searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') performAdvancedSearch();
      });

      document.getElementById('selectAllBtn').addEventListener('click', () => {
        document.querySelectorAll('.category-checkbox').forEach(cb => {
          cb.checked = true;
          cb.closest('.category-card').style.opacity = '1';
        });
        showNotification('All categories selected', 'success');
      });

      document.getElementById('deselectAllBtn').addEventListener('click', () => {
        document.querySelectorAll('.category-checkbox').forEach(cb => {
          cb.checked = false;
          cb.closest('.category-card').style.opacity = '0.6';
        });
        showNotification('All categories deselected', 'info');
      });

      document.getElementById('selectRecommendedBtn').addEventListener('click', () => {
        const recommended = ['Professional Networks', 'Social Media', 'Professional Registers'];
        document.querySelectorAll('.category-checkbox').forEach(cb => {
          const isRecommended = recommended.includes(cb.dataset.category);
          cb.checked = isRecommended;
          cb.closest('.category-card').style.opacity = isRecommended ? '1' : '0.6';
        });
        showNotification('Recommended categories selected', 'success');
      });

      document.getElementById('exportBtn')?.addEventListener('click', exportDetailedReport);
    }

    function exportDetailedReport() {
      if (!lastResults || lastResults.length === 0) {
        showNotification('No results to export', 'error');
        return;
      }

      const query = searchInput.value.trim();
      const timestamp = new Date().toLocaleString();
      const matches = lastResults.filter(r => r.hasMatch);
      
      let html = `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Advanced OSINT Report - ${query}</title>
          <meta charset="UTF-8">
          <style>
            body { font-family: 'Segoe UI', sans-serif; margin: 40px; line-height: 1.6; }
            h1 { color: #B13F17; border-bottom: 3px solid #B13F17; padding-bottom: 15px; }
            h2 { color: #B13F17; margin-top: 35px; }
            .summary { background: #f8f9fa; padding: 25px; border-radius: 10px; margin: 25px 0; }
            .match { background: #e8f5e8; padding: 20px; margin: 15px 0; border-radius: 8px; border-left: 5px solid #28a745; }
            .result-item { margin: 15px 0; padding: 15px; background: #f9f9f9; border-radius: 8px; }
            .highlight { background: #fff3cd; padding: 2px 4px; border-radius: 3px; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
            th { background-color: #f8f9fa; font-weight: 600; }
          </style>
        </head>
        <body>
          <h1>üîç Advanced OSINT Investigation Report</h1>
          
          <div class="summary">
            <h2>Investigation Summary</h2>
            <table>
              <tr><td><strong>Query:</strong></td><td>"${query}"</td></tr>
              <tr><td><strong>Generated:</strong></td><td>${timestamp}</td></tr>
              <tr><td><strong>Sites Investigated:</strong></td><td>${lastResults.length}</td></tr>
              <tr><td><strong>Positive Matches:</strong></td><td>${matches.length}</td></tr>
              <tr><td><strong>Success Rate:</strong></td><td>${((matches.length/lastResults.length)*100).toFixed(1)}%</td></tr>
              <tr><td><strong>Average Relevance:</strong></td><td>${(lastResults.reduce((s,r) => s + r.relevanceScore, 0) / lastResults.length).toFixed(1)}/10</td></tr>
            </table>
          </div>
      `;

      if (matches.length > 0) {
        html += '<h2>‚úÖ Detailed Findings</h2>';
        matches.forEach(result => {
          html += `
            <div class="match">
              <h3>${result.site} (Relevance: ${result.relevanceScore}/10)</h3>
              <p><strong>Category:</strong> ${result.category}</p>
              <p><strong>Search URL:</strong> <a href="${result.searchUrl}" target="_blank">${result.searchUrl}</a></p>
              <p><strong>Results Found:</strong> ${result.results?.length || 0}</p>
          `;
          
          if (result.results && result.results.length > 0) {
            html += '<h4>Individual Results:</h4>';
            result.results.forEach((item, idx) => {
              html += `
                <div class="result-item">
                  <p><strong>Result ${idx + 1}:</strong> ${item.title}</p>
                  ${item.snippet ? `<p><em>${item.snippet}</em></p>` : ''}
                  ${item.url ? `<p><strong>Direct Link:</strong> <a href="${item.url}" target="_blank">${item.url}</a></p>` : ''}
                  <p><strong>Confidence:</strong> ${item.confidence} | <strong>Relevance:</strong> ${item.relevance}/10</p>
                </div>
              `;
            });
          }
          
          html += '</div>';
        });
      }

      // Add no matches section
      const noMatches = lastResults.filter(r => !r.hasMatch);
      if (noMatches.length > 0) {
        html += '<h2>‚ùå Sites with No Matches</h2>';
        html += '<table><tr><th>Site</th><th>Category</th><th>Status</th></tr>';
        noMatches.forEach(result => {
          html += `
            <tr>
              <td>${result.site}</td>
              <td>${result.category}</td>
              <td>${result.error || 'No matches found'}</td>
            </tr>
          `;
        });
        html += '</table>';
      }

      html += `
          <div style="margin-top: 50px; padding-top: 20px; border-top: 2px solid #eee; color: #666; font-size: 0.9em;">
            <p><strong>Disclaimer:</strong> This report was generated by an automated OSINT tool. All findings should be verified through additional sources and proper investigative procedures.</p>
            <p><strong>Generated by:</strong> Advanced OSINT Search Tool</p>
            <p><strong>Report Type:</strong> Comprehensive Investigation with Direct Result Links</p>
          </div>
        </body>
        </html>
      `;

      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `OSINT_Investigation_${query.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Detailed report exported successfully!', 'success');
    }

    // Initialize the application
    function init() {
      initializeCategories();
      setupEventListeners();
      showNotification('Advanced OSINT Search Tool initialized successfully!', 'success');
    }

    // Start the application when DOM is ready
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
